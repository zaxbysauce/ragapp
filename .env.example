# KnowledgeVault Configuration
# Copy this file to .env and customize the values

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
PORT=8080

# Data Directory Configuration
# Host path for Docker volume mount - path on your host machine where data will be persisted
HOST_DATA_DIR=./data
# Container path for data storage - path inside the Docker container
DATA_DIR=/data/knowledgevault

# =============================================================================
# AUTHENTICATION & SECURITY
# =============================================================================
# Admin API key for accessing protected endpoints.
# Set to a secure random string to enable authentication.
# Leave as default "admin-secret-token" to disable authentication (development mode).
# Generate a secure key: openssl rand -base64 32
ADMIN_SECRET_TOKEN=admin-secret-token

# Rate limiting for admin endpoints (e.g., "10/minute")
ADMIN_RATE_LIMIT=10/minute

# Health check API key for external monitoring
HEALTH_CHECK_API_KEY=health-api-key

# CSRF token time-to-live in seconds (default: 900 = 15 minutes)
CSRF_TOKEN_TTL=900

# Redis URL for CSRF token storage and caching
# Use "redis://localhost:6379/0" for local Redis
# In Docker: "redis://redis:6379/0"
REDIS_URL=redis://localhost:6379/0

# CORS allowed origins (comma-separated list)
# For development: http://localhost:5173
# For production: https://yourdomain.com
BACKEND_CORS_ORIGINS=http://localhost:5173

# =============================================================================
# OLLAMA CONFIGURATION
# =============================================================================
# URLs for Ollama embedding and chat services
OLLAMA_EMBEDDING_URL=http://host.docker.internal:11434
OLLAMA_CHAT_URL=http://host.docker.internal:11434

# =============================================================================
# MODEL CONFIGURATION
# =============================================================================
# Embedding model for document vectorization
# Recommended: bge-m3 (multilingual, supports up to 8192 tokens)
# Alternatives: nomic-embed-text, qwen3-embedding:4b
EMBEDDING_MODEL=nomic-embed-text

# Chat model for conversational responses
CHAT_MODEL=qwen2.5:32b

# Embedding dimension (auto-detected, but can be overridden)
# bge-m3 = 1024, nomic-embed-text = 768
EMBEDDING_DIM=768

# Enable model validation on startup (checks if models are available in Ollama)
ENABLE_MODEL_VALIDATION=false

# =============================================================================
# DOCUMENT PROCESSING (NEW CHARACTER-BASED CONFIGURATION)
# =============================================================================
# Character-based chunk size (~4 chars per token)
# Default: 2000 chars (~500 tokens) - compatible with llama.cpp default batch size
CHUNK_SIZE_CHARS=2000

# Character-based overlap between chunks
# Default: 200 chars (~50 tokens overlap)
CHUNK_OVERLAP_CHARS=200

# Document parsing strategy for unstructured.io
# Options: "fast" (fastest), "hi_res" (best quality), "auto" (automatic)
DOCUMENT_PARSING_STRATEGY=fast

# =============================================================================
# RETRIEVAL CONFIGURATION
# =============================================================================
# Number of top chunks to retrieve for RAG context
# This is the canonical setting (replaces MAX_CONTEXT_CHUNKS and VECTOR_TOP_K)
RETRIEVAL_TOP_K=12

# Maximum distance threshold for relevance filtering
# For cosine distance: 0=identical, 1=orthogonal, 2=opposite
# 0.5 is a good default balance between precision and recall
MAX_DISTANCE_THRESHOLD=0.5

# Distance metric for vector similarity search
# Options: "cosine", "l2", "dot"
VECTOR_METRIC=cosine

# Window size for retrieval context expansion (fetches N adjacent chunks)
RETRIEVAL_WINDOW=1

# =============================================================================
# EMBEDDING CONFIGURATION
# =============================================================================
# Number of texts to send per embedding API request
# Higher values = better GPU utilization but more VRAM usage
EMBEDDING_BATCH_SIZE=512

# Maximum retries for adaptive batching when token overflow occurs
EMBEDDING_BATCH_MAX_RETRIES=3

# Minimum sub-batch size for adaptive batching fallback
EMBEDDING_BATCH_MIN_SUB_SIZE=1

# Optional prefixes for instruction-based embedding models (e.g., Qwen3)
# Leave empty for BGE-M3 (doesn't use prefixes)
EMBEDDING_DOC_PREFIX=
EMBEDDING_QUERY_PREFIX=

# =============================================================================
# RERANKER CONFIGURATION (Future Feature)
# =============================================================================
# Enable cross-encoder reranking for better retrieval quality
RERANKING_ENABLED=false

# Reranker endpoint URL (TEI-compatible)
# Leave empty to use local sentence-transformers
RERANKER_URL=

# Reranker model (HuggingFace model ID)
RERANKER_MODEL=BAAI/bge-reranker-v2-m3

# Number of chunks to keep after reranking
RERANKER_TOP_N=5

# Initial retrieval count before reranking
INITIAL_RETRIEVAL_TOP_K=20

# =============================================================================
# HYBRID SEARCH CONFIGURATION (Future Feature)
# =============================================================================
# Enable hybrid search: combines dense vector + BM25 keyword search
HYBRID_SEARCH_ENABLED=false

# Weight for dense vs sparse scores in RRF fusion
# 0.0 = pure BM25, 1.0 = pure dense, 0.5 = equal weight
HYBRID_ALPHA=0.5

# =============================================================================
# LEGACY/DEPRECATED SETTINGS (Still supported for backward compatibility)
# =============================================================================
# [DEPRECATED] Use CHUNK_SIZE_CHARS instead
CHUNK_SIZE=512

# [DEPRECATED] Use CHUNK_OVERLAP_CHARS instead
CHUNK_OVERLAP=50

# [DEPRECATED] Use RETRIEVAL_TOP_K instead
MAX_CONTEXT_CHUNKS=10
VECTOR_TOP_K=10

# [DEPRECATED] Use MAX_DISTANCE_THRESHOLD instead
RAG_RELEVANCE_THRESHOLD=0.1

# =============================================================================
# FILE UPLOAD SECURITY
# =============================================================================
# Maximum file upload size in MB
MAX_FILE_SIZE_MB=50

# Allowed file extensions for upload (comma-separated)
ALLOWED_EXTENSIONS=.txt,.md,.pdf,.docx,.csv,.json,.sql,.py,.js,.ts,.html,.css,.xml,.yaml,.yml

# =============================================================================
# LOGGING
# =============================================================================
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# =============================================================================
# AUTO-SCAN CONFIGURATION
# =============================================================================
# Enable automatic periodic scanning of data directory for new files
AUTO_SCAN_ENABLED=true
# Interval in minutes between automatic scans
AUTO_SCAN_INTERVAL_MINUTES=60

# =============================================================================
# MAINTENANCE MODE
# =============================================================================
# Enable maintenance mode (blocks document uploads and RAG queries)
MAINTENANCE_MODE=false

# =============================================================================
# IMAP EMAIL INGESTION CONFIGURATION
# =============================================================================
# Enable email ingestion via IMAP (requires valid IMAP settings below)
IMAP_ENABLED=false
# IMAP server hostname (e.g., mail.yourdomain.com)
IMAP_HOST=
# IMAP server port (default: 993 for SSL, 143 for non-SSL)
IMAP_PORT=993
# Use SSL/TLS for IMAP connection (true for port 993, false for port 143)
IMAP_USE_SSL=true
# IMAP account username (e.g., ragbot@yourdomain.com)
IMAP_USERNAME=
# IMAP account password
IMAP_PASSWORD=
# Mailbox to poll (default: INBOX)
IMAP_MAILBOX=INBOX
# Polling interval in seconds (default: 60)
IMAP_POLL_INTERVAL=60
# Maximum attachment size to process (in bytes, default: 10MB)
IMAP_MAX_ATTACHMENT_SIZE=10485760
