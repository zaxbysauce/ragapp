{"id":"S12","summaryText":"[SUMMARY S12] 31.1 KB | code | 682 lines\n<path>C:\\opencode\\RAGAPPv2\\frontend\\src\\pages\\DocumentsPage.tsx</path>\n<type>file</type>\n<content>1: import { useState, useEffect, useCallback, useMemo, useRef } from \"react\";\n2: import { useDropzone, type FileRejection } from \"react-dropzone\";\n3: import { toast } from \"sonner\";\nâ†’ Use /swarm retrieve S12 for full content","fullOutput":"<path>C:\\opencode\\RAGAPPv2\\frontend\\src\\pages\\DocumentsPage.tsx</path>\n<type>file</type>\n<content>1: import { useState, useEffect, useCallback, useMemo, useRef } from \"react\";\n2: import { useDropzone, type FileRejection } from \"react-dropzone\";\n3: import { toast } from \"sonner\";\n4: import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\n5: import { Button } from \"@/components/ui/button\";\n6: import { Input } from \"@/components/ui/input\";\n7: import { Badge } from \"@/components/ui/badge\";\n8: import { Progress } from \"@/components/ui/progress\";\n9: import { Skeleton } from \"@/components/ui/skeleton\";\n10: import { Checkbox } from \"@/components/ui/checkbox\";\n11: import { FileText, Upload, Search, Trash2, ScanLine, AlertCircle, Loader2, X, RotateCcw, Trash } from \"lucide-react\";\n12: import { listDocuments, scanDocuments, deleteDocument, deleteDocuments, deleteAllDocumentsInVault, getDocumentStats, type Document, type DocumentStatsResponse } from \"@/lib/api\";\n13: import { formatFileSize, formatDate } from \"@/lib/formatters\";\n14: import { useDebounce } from \"@/hooks/useDebounce\";\n15: import { useVaultStore } from \"@/stores/useVaultStore\";\n16: import { useUploadStore } from \"@/stores/useUploadStore\";\n17: import { VaultSelector } from \"@/components/vault/VaultSelector\";\n18: import { StatusBadge } from \"@/components/shared/StatusBadge\";\n19: import { DocumentCard } from \"@/components/shared/DocumentCard\";\n20: import { EmptyState } from \"@/components/shared/EmptyState\";\n21: \n22: const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB\n23: \n24: export default function DocumentsPage() {\n25:   const [documents, setDocuments] = useState<Document[]>([]);\n26:   const [stats, setStats] = useState<DocumentStatsResponse | null>(null);\n27:   const [loading, setLoading] = useState(true);\n28:   const [searchQuery, setSearchQuery] = useState(\"\");\n29:   const [debouncedSearchQuery, isSearching] = useDebounce(searchQuery, 300);\n30:   const [isScanning, setIsScanning] = useState(false);\n31:   const [rejectedFiles, setRejectedFiles] = useState<string[]>([]);\n32:   const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n33:   const [isBulkDeleting, setIsBulkDeleting] = useState(false);\n34:   const [isBulkDeletingAll, setIsBulkDeletingAll] = useState(false);\n35:   const [filenameColWidth, setFilenameColWidth] = useState<number>(250);\n36:   const dragState = useRef<{ startX: number; startWidth: number }>({ startX: 0, startWidth: 0 });\n37: \n38:   // Cleanup on unmount: restore cursor if component is destroyed during a drag\n39:   useEffect(() => {\n40:     return () => {\n41:       document.body.style.cursor = '';\n42:     };\n43:   }, []);\n44: \n45:   // Global upload store\n46:   const { uploads, addUploads, cancelUpload, removeUpload, clearCompleted, retryUpload } = useUploadStore();\n47:   const { activeVaultId } = useVaultStore();\n48: \n49:   const fetchDocuments = useCallback(async () => {\n50:     try {\n51:       const response = await listDocuments(activeVaultId ?? undefined);\n52:       setDocuments(response.documents);\n53:     } catch (err) {\n54:       console.error(\"Failed to fetch documents:\", err);\n55:       toast.error(err instanceof Error ? err.message : \"Failed to load documents\");\n56:     }\n57:   }, [activeVaultId]);\n58: \n59:   const fetchStats = useCallback(async () => {\n60:     try {\n61:       const response = await getDocumentStats(activeVaultId ?? undefined);\n62:       setStats(response);\n63:     } catch (err) {\n64:       console.error(\"Failed to fetch stats:\", err);\n65:       toast.error(err instanceof Error ? err.message : \"Failed to load document stats\");\n66:     }\n67:   }, [activeVaultId]);\n68: \n69:   const handleResizeMouseDown = useCallback((e: React.MouseEvent<HTMLDivElement>) => {\n70:     e.preventDefault();\n71:     dragState.current = { startX: e.clientX, startWidth: filenameColWidth };\n72:     const originalCursor = document.body.style.cursor;\n73:     document.body.style.cursor = 'col-resize';\n74: \n75:     const handleMouseMove = (moveEvent: MouseEvent) => {\n76:       const deltaX = moveEvent.clientX - dragState.current.startX;\n77:       const newWidth = Math.max(120, Math.min(600, dragState.current.startWidth + deltaX));\n78:       setFilenameColWidth(newWidth);\n79:     };\n80: \n81:     const handleMouseUp = () => {\n82:       document.body.style.cursor = originalCursor;\n83:       document.removeEventListener('mousemove', handleMouseMove);\n84:       document.removeEventListener('mouseup', handleMouseUp);\n85:     };\n86: \n87:     document.addEventListener('mousemove', handleMouseMove);\n88:     document.addEventListener('mouseup', handleMouseUp);\n89:   }, [filenameColWidth]);\n90: \n91:   useEffect(() => {\n92:     const loadData = async () => {\n93:       setLoading(true);\n94:       await Promise.all([fetchDocuments(), fetchStats()]);\n95:       setLoading(false);\n96:     };\n97:     loadData();\n98:   }, [fetchDocuments, fetchStats]);\n99: \n100:   // Status polling for documents in processing state\n101:   useEffect(() => {\n102:     const hasProcessingDocs = documents.some(\n103:       (doc) => doc.metadata?.status === \"processing\" || doc.metadata?.status === \"pending\"\n104:     );\n105: \n106:     if (!hasProcessingDocs) return;\n107: \n108:     const interval = setInterval(() => {\n109:       fetchDocuments();\n110:       fetchStats();\n111:     }, 5000);\n112: \n113:     return () => clearInterval(interval);\n114:   }, [documents, fetchDocuments, fetchStats]);\n115: \n116:   // Refresh documents when uploads complete\n117:   useEffect(() => {\n118:     const completedCount = uploads.filter((u) => u.status === \"completed\").length;\n119:     if (completedCount > 0) {\n120:       // Refresh after a short delay to allow backend processing\n121:       const timeout = setTimeout(() => {\n122:         fetchDocuments();\n123:         fetchStats();\n124:       }, 1000);\n125:       return () => clearTimeout(timeout);\n126:     }\n127:   }, [uploads, fetchDocuments, fetchStats]);\n128: \n129:   // Bulk selection handlers\n130:   const handleSelectAll = useCallback((checked: boolean | 'indeterminate') => {\n131:     if (checked) {\n132:       const allIds = new Set(documents.map((doc) => String(doc.id)));\n133:       setSelectedIds(allIds);\n134:     } else {\n135:       setSelectedIds(new Set());\n136:     }\n137:   }, [documents]);\n138: \n139:   const handleSelectOne = useCallback((docId: string, checked: boolean) => {\n140:     setSelectedIds(prev => {\n141:       const newSet = new Set(prev);\n142:       if (checked) {\n143:         newSet.add(docId);\n144:       } else {\n145:         newSet.delete(docId);\n146:       }\n147:       return newSet;\n148:     });\n149:   }, []);\n150: \n151:   const handleBulkDelete = useCallback(async () => {\n152:     if (selectedIds.size === 0) return;\n153:     \n154:     const confirmMsg = `Are you sure you want to delete ${selectedIds.size} document${selectedIds.size > 1 ? 's' : ''}?`;\n155:     if (!window.confirm(confirmMsg)) return;\n156: \n157:     setIsBulkDeleting(true);\n158: \n159:     try {\n160:       const result = await deleteDocuments(Array.from(selectedIds));\n161:       if (result.deleted_count > 0) {\n162:         toast.success(`Deleted ${result.deleted_count} document${result.deleted_count > 1 ? 's' : ''}`);\n163:         setDocuments(prev => prev.filter(doc => !selectedIds.has(doc.id)));\n164:         setStats(prev => prev ? { ...prev, total_documents: Math.max(0, (prev.total_documents ?? 0) - result.deleted_count) } : prev);\n165:       }\n166: \n167:       if (result.failed_ids.length > 0) {\n168:         toast.error(`Failed to delete ${result.failed_ids.length} document${result.failed_ids.length > 1 ? 's' : ''}`);\n169:       }\n170: \n171:       setSelectedIds(new Set());\n172:     } catch (err) {\n173:       toast.error(err instanceof Error ? err.message : \"Failed to delete documents\");\n174:     } finally {\n175:       setIsBulkDeleting(false);\n176:     }\n177:   }, [selectedIds]);\n178: \n179:   const handleDeleteAllInVault = useCallback(async () => {\n180:     if (documents.length === 0) return;\n181:     if (!activeVaultId) {\n182:       toast.error(\"No vault selected\");\n183:       return;\n184:     }\n185: \n186:     const confirmMsg = `Are you sure you want to delete ALL documents in this vault? This action cannot be undone.`;\n187:     if (!window.confirm(confirmMsg)) return;\n188: \n189:     setIsBulkDeletingAll(true);\n190: \n191:     try {\n192:       const result = await deleteAllDocumentsInVault(activeVaultId);\n193:       if (result.deleted_count > 0) {\n194:         toast.success(`Deleted ${result.deleted_count} document${result.deleted_count > 1 ? 's' : ''}`);\n195:         setDocuments([]);\n196:         setStats(prev => prev ? { ...prev, total_documents: 0 } : prev);\n197:       }\n198:     } catch (err) {\n199:       toast.error(err instanceof Error ? err.message : \"Failed to delete documents\");\n200:     } finally {\n201:       setIsBulkDeletingAll(false);\n202:     }\n203:   }, [documents.length, activeVaultId]);\n204: \n205:   const onDrop = useCallback((acceptedFiles: File[]) => {\n206:     if (acceptedFiles.length === 0) return;\n207:     \n208:     addUploads(acceptedFiles, activeVaultId ?? undefined);\n209:     setRejectedFiles([]);\n210:     toast.success(`Added ${acceptedFiles.length} file(s) to upload queue`);\n211:   }, [addUploads, activeVaultId]);\n212: \n213:   const onDropRejected = useCallback((rejected: FileRejection[]) => {\n214:     const rejectedNames = rejected.map((r) => `${r.file.name} (${r.errors.map((e) => e.message).join(', ')})`);\n215:     setRejectedFiles(rejectedNames);\n216:     rejectedNames.forEach((name) => {\n217:       toast.error(`File rejected: ${name}`);\n218:     });\n219:   }, []);\n220: \n221:   const { getRootProps, getInputProps, isDragActive } = useDropzone({\n222:     onDrop,\n223:     onDropRejected,\n224:     accept: {\n225:       'application/pdf': ['.pdf'],\n226:       'text/plain': ['.txt'],\n227:       'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ['.docx'],\n228:       'application/msword': ['.doc'],\n229:       'text/markdown': ['.md'],\n230:     },\n231:     maxSize: MAX_FILE_SIZE,\n232:   });\n233: \n234:   const handleScan = async () => {\n235:     setIsScanning(true);\n236:     try {\n237:       const result = await scanDocuments(activeVaultId ?? undefined);\n238:       toast.success(`Scan complete: ${result.added} new document(s) added, ${result.scanned} scanned`);\n239:       await Promise.all([fetchDocuments(), fetchStats()]);\n240:     } catch (err) {\n241:       toast.error(err instanceof Error ? err.message : \"Scan failed\");\n242:     } finally {\n243:       setIsScanning(false);\n244:     }\n245:   };\n246: \n247:   const handleDeleteDocument = async (docId: string) => {\n248:     if (!confirm(\"Are you sure you want to delete this document? This will also remove all associated chunks.\")) return;\n249:     try {\n250:       await deleteDocument(docId);\n251:       toast.success(\"Document deleted successfully\");\n252:       await Promise.all([fetchDocuments(), fetchStats()]);\n253:     } catch (err) {\n254:       toast.error(err instanceof Error ? err.message : \"Failed to delete document\");\n255:     }\n256:   };\n257: \n258:   const filteredDocuments = useMemo(\n259:     () => documents.filter((doc) =>\n260:       doc.filename.toLowerCase().includes(debouncedSearchQuery.toLowerCase())\n261:     ),\n262:     [documents, debouncedSearchQuery]\n263:   );\n264: \n265:   return (\n266:     <div className=\"space-y-6 animate-in fade-in duration-300\">\n267:       <div className=\"flex items-center justify-between\">\n268:         <div>\n269:           <h1 className=\"text-3xl font-bold tracking-tight\">Documents</h1>\n270:           <p className=\"text-muted-foreground mt-1\">Manage your knowledge base documents</p>\n271:         </div>\n272:         <div className=\"flex items-center gap-2\">\n273:           <VaultSelector />\n274:           <Button onClick={handleScan} disabled={isScanning}>\n275:             {isScanning ? (\n276:               <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n277:             ) : (\n278:               <ScanLine className=\"w-4 h-4 mr-2\" />\n279:             )}\n280:             Scan Directory\n281:           </Button>\n282:           {filteredDocuments.length > 0 && (\n283:             <Button \n284:               variant=\"destructive\" \n285:               onClick={handleDeleteAllInVault} \n286:               disabled={isBulkDeletingAll}\n287:             >\n288:               {isBulkDeletingAll ? (\n289:                 <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n290:               ) : (\n291:                 <Trash className=\"w-4 h-4 mr-2\" />\n292:               )}\n293:               Delete All in Vault\n294:             </Button>\n295:           )}\n296:         </div>\n297:       </div>\n298: \n299:       {stats && (\n300:         <div className=\"grid gap-4 md:grid-cols-4\">\n301:           <Card>\n302:             <CardHeader className=\"pb-2\">\n303:               <CardDescription>Total Documents</CardDescription>\n304:               <CardTitle className=\"text-3xl\">{stats.total_documents}</CardTitle>\n305:             </CardHeader>\n306:           </Card>\n307:           <Card>\n308:             <CardHeader className=\"pb-2\">\n309:               <CardDescription>Total Chunks</CardDescription>\n310:               <CardTitle className=\"text-3xl\">{stats.total_chunks}</CardTitle>\n311:             </CardHeader>\n312:           </Card>\n313:           <Card>\n314:             <CardHeader className=\"pb-2\">\n315:               <CardDescription>Total Size</CardDescription>\n316:               <CardTitle className=\"text-3xl\">{formatFileSize(stats.total_size_bytes)}</CardTitle>\n317:             </CardHeader>\n318:           </Card>\n319:           <Card>\n320:             <CardHeader className=\"pb-2\">\n321:               <CardDescription>Processed</CardDescription>\n322:               <CardTitle className=\"text-3xl\">{stats.documents_by_status?.processed || 0}</CardTitle>\n323:             </CardHeader>\n324:           </Card>\n325:         </div>\n326:       )}\n327: \n328:       <Card\n329:         {...getRootProps()}\n330:         className={`border-2 border-dashed cursor-pointer transition-colors ${\n331:           isDragActive ? \"border-primary bg-primary/5\" : \"border-border\"\n332:         }`}\n333:       >\n334:         <input {...getInputProps()} />\n335:         <CardContent className=\"py-8\">\n336:           <div className=\"flex flex-col items-center justify-center text-center\">\n337:             <Upload className=\"w-12 h-12 text-muted-foreground mb-4\" />\n338:             <p className=\"text-lg font-medium\">\n339:               {isDragActive ? \"Drop files here...\" : \"Drag & drop files here, or click to select\"}\n340:             </p>\n341:             <p className=\"text-sm text-muted-foreground mt-1\">\n342:               Supports PDF, DOCX, TXT, MD files (max 50MB each). Uploads continue in background.\n343:             </p>\n344:           </div>\n345:         </CardContent>\n346:       </Card>\n347: \n348:       {/* Upload Queue */}\n349:       {uploads.length > 0 && (\n350:         <Card>\n351:           <CardHeader className=\"flex flex-row items-center justify-between\">\n352:             <div>\n353:               <CardTitle className=\"text-sm\">Upload Queue</CardTitle>\n354:               <CardDescription>\n355:                 {uploads.filter((u) => u.status === \"pending\").length} pending,{\" \"}\n356:                 {uploads.filter((u) => u.status === \"uploading\").length} uploading,{\" \"}\n357:                 {uploads.filter((u) => u.status === \"completed\").length} completed\n358:               </CardDescription>\n359:             </div>\n360:             {uploads.some((u) => u.status === \"completed\" || u.status === \"error\" || u.status === \"cancelled\") && (\n361:               <Button variant=\"ghost\" size=\"sm\" onClick={clearCompleted}>\n362:                 Clear Completed\n363:               </Button>\n364:             )}\n365:           </CardHeader>\n366:           <CardContent className=\"space-y-3\">\n367:             {uploads.map((upload) => (\n368:               <div key={upload.id} className=\"space-y-2\">\n369:                 <div className=\"flex justify-between items-center text-sm\">\n370:                   <span className=\"truncate max-w-[250px]\" title={upload.file.name}>\n371:                     {upload.file.name}\n372:                   </span>\n373:                   <div className=\"flex items-center gap-2\">\n374:                     {upload.status === \"completed\" && (\n375:                       <span className=\"text-green-500 text-xs\">Done</span>\n376:                     )}\n377:                     {upload.status === \"error\" && (\n378:                       <span className=\"text-destructive text-xs\" title={upload.error}>\n379:                         Error\n380:                       </span>\n381:                     )}\n382:                     {upload.status === \"cancelled\" && (\n383:                       <span className=\"text-muted-foreground text-xs\">Cancelled</span>\n384:                     )}\n385:                     {upload.status === \"pending\" && (\n386:                       <span className=\"text-muted-foreground text-xs\">Pending</span>\n387:                     )}\n388:                     {upload.status === \"uploading\" && (\n389:                       <span className=\"text-muted-foreground text-xs\">\n390:                         {upload.progress > 0 ? `${upload.progress}%` : \"Uploading...\"}\n391:                       </span>\n392:                     )}\n393:                     \n394:                     {upload.status === \"pending\" && (\n395:                       <Button\n396:                         variant=\"ghost\"\n397:                         size=\"icon\"\n398:                         className=\"h-7 w-7\"\n399:                         onClick={() => cancelUpload(upload.id)}\n400:                         aria-label={`Cancel upload for ${upload.file.name}`}\n401:                       >\n402:                         <X className=\"w-3 h-3\" />\n403:                       </Button>\n404:                     )}\n405:                     {upload.status === \"error\" && (\n406:                       <Button\n407:                         variant=\"ghost\"\n408:                         size=\"icon\"\n409:                         className=\"h-7 w-7\"\n410:                         onClick={() => retryUpload(upload.id)}\n411:                         aria-label={`Retry upload for ${upload.file.name}`}\n412:                       >\n413:                         <RotateCcw className=\"w-3 h-3\" />\n414:                       </Button>\n415:                     )}\n416:                     {(upload.status === \"completed\" || upload.status === \"cancelled\" || upload.status === \"error\") && (\n417:                       <Button\n418:                         variant=\"ghost\"\n419:                         size=\"icon\"\n420:                         className=\"h-7 w-7\"\n421:                         onClick={() => removeUpload(upload.id)}\n422:                         aria-label={`Remove ${upload.file.name} from queue`}\n423:                       >\n424:                         <X className=\"w-3 h-3\" />\n425:                       </Button>\n426:                     )}\n427:                   </div>\n428:                 </div>\n429:                 {upload.status === \"uploading\" && (\n430:                   <Progress value={upload.progress} className=\"h-1.5\" />\n431:                 )}\n432:               </div>\n433:             ))}\n434:           </CardContent>\n435:         </Card>\n436:       )}\n437: \n438:       {rejectedFiles.length > 0 && (\n439:         <div className=\"p-4 bg-amber-500/10 text-amber-700 rounded-lg\">\n440:           <div className=\"flex items-center gap-2 mb-2\">\n441:             <AlertCircle className=\"w-5 h-5\" />\n442:             <span className=\"font-medium\">Some files were rejected:</span>\n443:           </div>\n444:           <ul className=\"list-disc pl-5 space-y-1\">\n445:             {rejectedFiles.map((file, index) => (\n446:               <li key={index} className=\"text-sm\">{file}</li>\n447:             ))}\n448:           </ul>\n449:         </div>\n450:       )}\n451: \n452:       <div className=\"flex items-center gap-4\">\n453:         <div className=\"relative flex-1 max-w-md\">\n454:           <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n455:           <Input\n456:             placeholder=\"Search documents...\"\n457:             className=\"pl-10\"\n458:             value={searchQuery}\n459:             onChange={(e) => setSearchQuery(e.target.value)}\n460:           />\n461:           {isSearching && (\n462:             <Loader2 className=\"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground animate-spin\" />\n463:           )}\n464:         </div>\n465:         <div className=\"flex items-center gap-2\">\n466:           {selectedIds.size > 0 && (\n467:             <>\n468:               <Badge variant=\"outline\">{selectedIds.size} selected</Badge>\n469:               <Button \n470:                 variant=\"destructive\" \n471:                 size=\"sm\"\n472:                 onClick={handleBulkDelete}\n473:                 disabled={isBulkDeleting}\n474:               >\n475:                 {isBulkDeleting ? (\n476:                   <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n477:                 ) : (\n478:                   <Trash2 className=\"w-4 h-4 mr-2\" />\n479:                 )}\n480:                 Delete Selected\n481:               </Button>\n482:             </>\n483:           )}\n484:           <Badge variant=\"secondary\">{filteredDocuments.length} documents</Badge>\n485:         </div>\n486:       </div>\n487: \n488:       {loading ? (\n489:         <>\n490:           {/* Desktop Table Skeleton (hidden on mobile) */}\n491:           <Card className=\"hidden sm:block\">\n492:             <CardContent className=\"p-0\">\n493:               <div className=\"overflow-x-auto\">\n494:               <table className=\"w-full\">\n495:                 <caption className=\"sr-only\">Documents List</caption>\n496:                 <thead>\n497:                   <tr className=\"border-b bg-muted/50\">\n498:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">\n499:                       <Checkbox disabled aria-label=\"Select all documents\" />\n500:                     </th>\n501:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">Filename</th>\n502:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">Status</th>\n503:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">Chunks</th>\n504:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">Size</th>\n505:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">Uploaded</th>\n506:                     <th scope=\"col\" className=\"text-right p-4 font-medium\">Actions</th>\n507:                   </tr>\n508:                 </thead>\n509:                 <tbody>\n510:                   {[...Array(5)].map((_, i) => (\n511:                     <tr key={i} className=\"border-b\">\n512:                       <td className=\"p-4\">\n513:                         <Checkbox disabled />\n514:                       </td>\n515:                       <td className=\"p-4\">\n516:                         <div className=\"flex items-center gap-2\">\n517:                           <Skeleton className=\"h-4 w-4\" />\n518:                           <Skeleton className=\"h-4 w-[180px]\" />\n519:                         </div>\n520:                       </td>\n521:                       <td className=\"p-4\"><Skeleton className=\"h-5 w-[80px]\" /></td>\n522:                       <td className=\"p-4\"><Skeleton className=\"h-4 w-[40px]\" /></td>\n523:                       <td className=\"p-4\"><Skeleton className=\"h-4 w-[60px]\" /></td>\n524:                       <td className=\"p-4\"><Skeleton className=\"h-4 w-[80px]\" /></td>\n525:                       <td className=\"p-4 text-right\"><Skeleton className=\"h-11 w-11 ml-auto\" /></td>\n526:                     </tr>\n527:                   ))}\n528:                 </tbody>\n529:               </table>\n530:               </div>\n531:             </CardContent>\n532:           </Card>\n533: \n534:           {/* Mobile Cards Skeleton (hidden on desktop) */}\n535:           <div className=\"grid grid-cols-1 gap-3 sm:hidden\">\n536:             {[...Array(3)].map((_, i) => (\n537:               <Card key={i} className=\"w-full\">\n538:                 <CardContent className=\"p-4\">\n539:                   <div className=\"flex items-start justify-between gap-3 mb-3\">\n540:                     <div className=\"flex items-center gap-3 min-w-0 flex-1\">\n541:                       <Skeleton className=\"h-11 w-11 rounded-md\" />\n542:                       <div className=\"min-w-0\">\n543:                         <Skeleton className=\"h-5 w-32 mb-1\" />\n544:                         <Skeleton className=\"h-4 w-24\" />\n545:                       </div>\n546:                     </div>\n547:                     <Skeleton className=\"h-11 w-11 rounded-full\" />\n548:                   </div>\n549:                   <div className=\"grid grid-cols-2 gap-3 text-sm\">\n550:                     <div className=\"space-y-1\">\n551:                       <Skeleton className=\"h-4 w-16\" />\n552:                       <Skeleton className=\"h-6 w-20\" />\n553:                     </div>\n554:                     <div className=\"space-y-1\">\n555:                       <Skeleton className=\"h-4 w-16\" />\n556:                       <Skeleton className=\"h-4 w-16\" />\n557:                     </div>\n558:                     <div className=\"space-y-1\">\n559:                       <Skeleton className=\"h-4 w-16\" />\n560:                       <Skeleton className=\"h-4 w-20\" />\n561:                     </div>\n562:                     <div className=\"space-y-1\">\n563:                       <Skeleton className=\"h-4 w-16\" />\n564:                       <Skeleton className=\"h-4 w-12\" />\n565:                     </div>\n566:                   </div>\n567:                   <div className=\"mt-4 flex sm:hidden\">\n568:                     <Skeleton className=\"h-11 w-full rounded-md\" />\n569:                   </div>\n570:                 </CardContent>\n571:               </Card>\n572:             ))}\n573:           </div>\n574:         </>\n575:       ) : filteredDocuments.length === 0 ? (\n576:         <EmptyState\n577:           icon={FileText}\n578:           title={searchQuery ? \"No documents match your search\" : \"No documents yet\"}\n579:           description={searchQuery ? undefined : \"Upload some files to get started.\"}\n580:         />\n581:       ) : (\n582:         <>\n583:           {/* Desktop Table View (hidden on mobile) */}\n584:           <Card className=\"hidden sm:block\">\n585:             <CardContent className=\"p-0\">\n586:               <div className=\"overflow-x-auto\">\n587:                 <table className=\"w-full\" style={{ tableLayout: 'fixed' }}>\n588:                   <caption className=\"sr-only\">Documents List</caption>\n589:                   <thead>\n590:                     <tr className=\"border-b bg-muted/50\">\n591:                       <th scope=\"col\" className=\"text-left p-4 font-medium\">\n592:                         <Checkbox \n593:                           checked={(selectedIds.size > 0 && selectedIds.size === filteredDocuments.length) ?? false}\n594:                           onCheckedChange={handleSelectAll}\n595:                           aria-label=\"Select all documents\"\n596:                         />\n597:                       </th>\n598:                       <th\n599:                         scope=\"col\"\n600:                         className=\"text-left p-4 font-medium relative\"\n601:                         style={{ width: filenameColWidth }}\n602:                       >\n603:                         Filename\n604:                         <div\n605:                           className=\"absolute right-0 top-0 h-full w-1.5 cursor-col-resize hover:bg-border transition-colors\"\n606:                           onMouseDown={handleResizeMouseDown}\n607:                           role=\"separator\"\n608:                           aria-orientation=\"vertical\"\n609:                           aria-label=\"Resize filename column\"\n610:                         />\n611:                       </th>\n612:                       <th scope=\"col\" className=\"text-left p-4 font-medium\">Status</th>\n613:                       <th scope=\"col\" className=\"text-left p-4 font-medium\">Chunks</th>\n614:                       <th scope=\"col\" className=\"text-left p-4 font-medium\">Size</th>\n615:                       <th scope=\"col\" className=\"text-left p-4 font-medium\">Uploaded</th>\n616:                       <th scope=\"col\" className=\"text-right p-4 font-medium\">Actions</th>\n617:                     </tr>\n618:                   </thead>\n619:                   <tbody>\n620:                     {filteredDocuments.map((doc) => {\n621:                       const docId = String(doc.id);\n622:                       const isSelected = Boolean(selectedIds.has(docId));\n623:                       return (\n624:                         <tr key={doc.id} className={`border-b hover:bg-muted/50 ${isSelected ? 'bg-muted/30' : ''}`}>\n625:                           <td className=\"p-4\">\n626:                             <Checkbox \n627:                               checked={isSelected ?? false}\n628:                               onCheckedChange={(checked) => handleSelectOne(String(doc.id), !!checked)}\n629:                               aria-label={`Select ${doc.filename}`}\n630:                             />\n631:                           </td>\n632:                           <td className=\"p-4\">\n633:                             <div className=\"flex items-center gap-2\">\n634:                               <FileText className=\"w-4 h-4 text-muted-foreground\" />\n635:                               <span className=\"font-medium truncate max-w-full\" title={doc.filename}>{doc.filename}</span>\n636:                             </div>\n637:                           </td>\n638:                           <td className=\"p-4\"><StatusBadge status={doc.metadata?.status as string} /></td>\n639:                           <td className=\"p-4\">{String(doc.metadata?.chunk_count ?? 0)}</td>\n640:                           <td className=\"p-4\">{formatFileSize(doc.size)}</td>\n641:                           <td className=\"p-4 text-muted-foreground\">{formatDate(doc.created_at)}</td>\n642:                           <td className=\"p-4 text-right\">\n643:                             <Button \n644:                               variant=\"ghost\" \n645:                               size=\"icon\" \n646:                               className=\"min-w-[44px] min-h-[44px]\" \n647:                               onClick={() => handleDeleteDocument(String(doc.id))}\n648:                             >\n649:                               <Trash2 className=\"w-4 h-4 text-destructive\" />\n650:                             </Button>\n651:                           </td>\n652:                         </tr>\n653:                       );\n654:                     })}\n655:                   </tbody>\n656:                 </table>\n657:               </div>\n658:             </CardContent>\n659:           </Card>\n660: \n661:            {/* Mobile Cards View (hidden on desktop) */}\n662:            <div className=\"grid grid-cols-1 gap-3 sm:hidden\">\n663:              {filteredDocuments.map((doc) => (\n664:                <DocumentCard\n665:                  key={doc.id}\n666:                  document={doc}\n667:                  onDelete={(id) => handleDeleteDocument(String(id))}\n668:                  isSelected={selectedIds.has(doc.id)}\n669:                  onSelectionChange={handleSelectOne}\n670:                />\n671:              ))}\n672:            </div>\n673:         </>\n674:       )}\n675:     </div>\n676:   );\n677: }\n\n(End of file - total 677 lines)\n</content>","timestamp":1771953005801,"originalBytes":31823}