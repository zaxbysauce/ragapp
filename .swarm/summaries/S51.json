{"id":"S51","summaryText":"[SUMMARY S51] 43.2 KB | code | 112 lines\nFound 52 matches\nC:\\opencode\\RAGAPPv2\\.swarm\\plan.md:\n  Line 133: - [ ] 6.8.4: Fix vault_id default mismatch between upload and chat [SMALL]\n  Line 135:   - ISSUE: Documents default to vault_id=1, CreateSessionRequest defaults to vault_id=1, but vault_id is Optional[int] = None in ChatRequest\n  Line 136:   - CHANGE: Ensure consistent default (vault_id=1) across upload, chat request, and session creation\n→ Use /swarm retrieve S51 for full content","fullOutput":"Found 52 matches\nC:\\opencode\\RAGAPPv2\\.swarm\\plan.md:\n  Line 133: - [ ] 6.8.4: Fix vault_id default mismatch between upload and chat [SMALL]\n  Line 135:   - ISSUE: Documents default to vault_id=1, CreateSessionRequest defaults to vault_id=1, but vault_id is Optional[int] = None in ChatRequest\n  Line 136:   - CHANGE: Ensure consistent default (vault_id=1) across upload, chat request, and session creation\n  Line 137:   - acceptance: All endpoints use vault_id=1 as default when not specified\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S46.json:\n  Line 1: {\"id\":\"S46\",\"summaryText\":\"[SUMMARY S46] 30.4 KB | code | 738 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S46 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query, Body\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:     - ...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S41.json:\n  Line 1: {\"id\":\"S41\",\"summaryText\":\"[SUMMARY S41] 26.3 KB | code | 697 lines\\n\\\"\\\"\\\"\\nLanceDB vector store service for semantic search.\\n\\\"\\\"\\\"\\nfrom pathlib import Path\\nfrom typing import Any, Dict, List, Optional\\n→ Use /swarm retrieve S41 for full content\",\"fullOutput\":\"\\\"\\\"\\\"\\nLanceDB vector store service for semantic search.\\n\\\"\\\"\\\"\\nfrom pathlib import Path\\nfrom typing import Any, Dict, List, Optional\\nimport lancedb\\nimport pyarrow as pa\\nimport numpy as np\\nimport logging\\n\\nfrom app.config import settings\\n\\nlogger = logging.getLogger(__name__)\\n\\nlogger = logging.getLogger(__name__)\\n\\n\\nclass VectorStoreError(Exception):\\n    \\\"\\\"\\\"Custom exception for vector store errors.\\\"\\\"\\\"\\n    pass\\n\\n\\nclass VectorStoreConnectionError(VectorStoreError):\\n    \\\"\\\"\\\"Exception raised when connection to LanceDB fails.\\\"\\\"\\\"\\n    pass\\n\\n\\nclass VectorStoreValidationError(VectorStoreError):\\n    \\\"\\\"\\\"Exception raised when record validation fails.\\\"\\\"\\\"\\n    pass\\n\\n\\nclass VectorStore:\\n    \\\"\\\"\\\"LanceDB-based vector store for document chunk embeddings.\\\"\\\"\\\"\\n    \\n    def __init__(self, db_path: Optional[Path] = None):\\n        \\\"\\\"\\\"\\n        Initialize the vector store.\\n        \\n        Args:\\n            db_path: Path to LanceDB database. Defaults to settings.lancedb_path.\\n        \\\"\\\"\\\"\\n        self.db_path = db_path or settings.lancedb_path\\n        self.db: Optional[lancedb.DBConnection] = None\\n        self.table: Optional[lancedb.table.Table] = None\\n        self._embedding_dim: Optional[int] = None\\n    \\n    def connect(self) -> \\\"VectorStore\\\":\\n        \\\"\\\"\\\"Connect to LanceDB.\\n        \\n        Raises:\\n            VectorStoreConnectionError: If connection to LanceDB fails.\\n        \\\"\\\"\\\"\\n        try:\\n            self.db = lancedb.connect(str(self.db_path))\\n        except Exception as e:\\n            raise VectorStoreConnectionError(f\\\"Failed to connect to LanceDB at {self.db_path}: {e}\\\") from e\\n        return self\\n    \\n    def init_table(self, em...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S39.json:\n  Line 1: {\"id\":\"S39\",\"summaryText\":\"[SUMMARY S39] 29.7 KB | code | 701 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\services\\\\vector_store.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: LanceDB vector store service for semantic search.\\n3: \\\"\\\"\\\"\\n→ Use /swarm retrieve S39 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\services\\\\vector_store.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: LanceDB vector store service for semantic search.\\n3: \\\"\\\"\\\"\\n4: from pathlib import Path\\n5: from typing import Any, Dict, List, Optional\\n6: import lancedb\\n7: import pyarrow as pa\\n8: import numpy as np\\n9: import logging\\n10: \\n11: from app.config import settings\\n12: \\n13: logger = logging.getLogger(__name__)\\n14: \\n15: logger = logging.getLogger(__name__)\\n16: \\n17: \\n18: class VectorStoreError(Exception):\\n19:     \\\"\\\"\\\"Custom exception for vector store errors.\\\"\\\"\\\"\\n20:     pass\\n21: \\n22: \\n23: class VectorStoreConnectionError(VectorStoreError):\\n24:     \\\"\\\"\\\"Exception raised when connection to LanceDB fails.\\\"\\\"\\\"\\n25:     pass\\n26: \\n27: \\n28: class VectorStoreValidationError(VectorStoreError):\\n29:     \\\"\\\"\\\"Exception raised when record validation fails.\\\"\\\"\\\"\\n30:     pass\\n31: \\n32: \\n33: class VectorStore:\\n34:     \\\"\\\"\\\"LanceDB-based vector store for document chunk embeddings.\\\"\\\"\\\"\\n35:     \\n36:     def __init__(self, db_path: Optional[Path] = None):\\n37:         \\\"\\\"\\\"\\n38:         Initialize the vector store.\\n39:         \\n40:         Args:\\n41:             db_path: Path to LanceDB database. Defaults to settings.lancedb_path.\\n42:         \\\"\\\"\\\"\\n43:         self.db_path = db_path or settings.lancedb_path\\n44:         self.db: Optional[lancedb.DBConnection] = None\\n45:         self.table: Optional[lancedb.table.Table] = None\\n46:         self._embedding_dim: Optional[int] = None\\n47:     \\n48:     def connect(self) -> \\\"VectorStore\\\":\\n49:         \\\"\\\"\\\"Connect to LanceDB.\\n50:         \\n51:         Raises:\\n52:           ...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S38.json:\n  Line 1: {\"id\":\"S38\",\"summaryText\":\"[SUMMARY S38] 29.7 KB | code | 701 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\services\\\\vector_store.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: LanceDB vector store service for semantic search.\\n3: \\\"\\\"\\\"\\n→ Use /swarm retrieve S38 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\services\\\\vector_store.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: LanceDB vector store service for semantic search.\\n3: \\\"\\\"\\\"\\n4: from pathlib import Path\\n5: from typing import Any, Dict, List, Optional\\n6: import lancedb\\n7: import pyarrow as pa\\n8: import numpy as np\\n9: import logging\\n10: \\n11: from app.config import settings\\n12: \\n13: logger = logging.getLogger(__name__)\\n14: \\n15: logger = logging.getLogger(__name__)\\n16: \\n17: \\n18: class VectorStoreError(Exception):\\n19:     \\\"\\\"\\\"Custom exception for vector store errors.\\\"\\\"\\\"\\n20:     pass\\n21: \\n22: \\n23: class VectorStoreConnectionError(VectorStoreError):\\n24:     \\\"\\\"\\\"Exception raised when connection to LanceDB fails.\\\"\\\"\\\"\\n25:     pass\\n26: \\n27: \\n28: class VectorStoreValidationError(VectorStoreError):\\n29:     \\\"\\\"\\\"Exception raised when record validation fails.\\\"\\\"\\\"\\n30:     pass\\n31: \\n32: \\n33: class VectorStore:\\n34:     \\\"\\\"\\\"LanceDB-based vector store for document chunk embeddings.\\\"\\\"\\\"\\n35:     \\n36:     def __init__(self, db_path: Optional[Path] = None):\\n37:         \\\"\\\"\\\"\\n38:         Initialize the vector store.\\n39:         \\n40:         Args:\\n41:             db_path: Path to LanceDB database. Defaults to settings.lancedb_path.\\n42:         \\\"\\\"\\\"\\n43:         self.db_path = db_path or settings.lancedb_path\\n44:         self.db: Optional[lancedb.DBConnection] = None\\n45:         self.table: Optional[lancedb.table.Table] = None\\n46:         self._embedding_dim: Optional[int] = None\\n47:     \\n48:     def connect(self) -> \\\"VectorStore\\\":\\n49:         \\\"\\\"\\\"Connect to LanceDB.\\n50:         \\n51:         Raises:\\n52:           ...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S36.json:\n  Line 1: {\"id\":\"S36\",\"summaryText\":\"[SUMMARY S36] 29.7 KB | code | 701 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\services\\\\vector_store.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: LanceDB vector store service for semantic search.\\n3: \\\"\\\"\\\"\\n→ Use /swarm retrieve S36 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\services\\\\vector_store.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: LanceDB vector store service for semantic search.\\n3: \\\"\\\"\\\"\\n4: from pathlib import Path\\n5: from typing import Any, Dict, List, Optional\\n6: import lancedb\\n7: import pyarrow as pa\\n8: import numpy as np\\n9: import logging\\n10: \\n11: from app.config import settings\\n12: \\n13: logger = logging.getLogger(__name__)\\n14: \\n15: logger = logging.getLogger(__name__)\\n16: \\n17: \\n18: class VectorStoreError(Exception):\\n19:     \\\"\\\"\\\"Custom exception for vector store errors.\\\"\\\"\\\"\\n20:     pass\\n21: \\n22: \\n23: class VectorStoreConnectionError(VectorStoreError):\\n24:     \\\"\\\"\\\"Exception raised when connection to LanceDB fails.\\\"\\\"\\\"\\n25:     pass\\n26: \\n27: \\n28: class VectorStoreValidationError(VectorStoreError):\\n29:     \\\"\\\"\\\"Exception raised when record validation fails.\\\"\\\"\\\"\\n30:     pass\\n31: \\n32: \\n33: class VectorStore:\\n34:     \\\"\\\"\\\"LanceDB-based vector store for document chunk embeddings.\\\"\\\"\\\"\\n35:     \\n36:     def __init__(self, db_path: Optional[Path] = None):\\n37:         \\\"\\\"\\\"\\n38:         Initialize the vector store.\\n39:         \\n40:         Args:\\n41:             db_path: Path to LanceDB database. Defaults to settings.lancedb_path.\\n42:         \\\"\\\"\\\"\\n43:         self.db_path = db_path or settings.lancedb_path\\n44:         self.db: Optional[lancedb.DBConnection] = None\\n45:         self.table: Optional[lancedb.table.Table] = None\\n46:         self._embedding_dim: Optional[int] = None\\n47:     \\n48:     def connect(self) -> \\\"VectorStore\\\":\\n49:         \\\"\\\"\\\"Connect to LanceDB.\\n50:         \\n51:         Raises:\\n52:           ...\n\nC:\\opencode\\RAGAPPv2\\backend\\app\\api\\routes\\documents.py:\n  Line 346:     vault_id: int = Query(1, description=\"Target vault ID\"),\n  Line 364:     vault_id: int = Query(1, description=\"Target vault ID\"),\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S835.json:\n  Line 1: {\"id\":\"S835\",\"summaryText\":\"[SUMMARY S835] 30.4 KB | code | 738 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S835 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query, Body\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:    ...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S834.json:\n  Line 1: {\"id\":\"S834\",\"summaryText\":\"[SUMMARY S834] 30.4 KB | code | 738 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S834 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query, Body\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:    ...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S786.json:\n  Line 1: {\"id\":\"S786\",\"summaryText\":\"[SUMMARY S786] 30.4 KB | code | 738 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S786 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query, Body\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:    ...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S784.json:\n  Line 1: {\"id\":\"S784\",\"summaryText\":\"[SUMMARY S784] 30.4 KB | code | 738 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S784 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query, Body\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:    ...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S780.json:\n  Line 1: {\"id\":\"S780\",\"summaryText\":\"[SUMMARY S780] 30.4 KB | code | 738 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S780 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query, Body\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:    ...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S778.json:\n  Line 1: {\"id\":\"S778\",\"summaryText\":\"[SUMMARY S778] 30.4 KB | code | 738 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S778 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query, Body\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:    ...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S739.json:\n  Line 1: {\"id\":\"S739\",\"summaryText\":\"[SUMMARY S739] 25.8 KB | code | 623 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S739 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:     - Rem...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S738.json:\n  Line 1: {\"id\":\"S738\",\"summaryText\":\"[SUMMARY S738] 25.8 KB | code | 623 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S738 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:     - Rem...\n\nC:\\opencode\\RAGAPPv2\\backend\\app\\services\\document_processor.py:\n  Line 144:     def _check_duplicate(self, file_hash: str, conn: sqlite3.Connection, vault_id: int = 1) -> Optional[sqlite3.Row]:\n  Line 151:             vault_id: The vault ID to check for duplicates in (defaults to 1)\n  Line 168:         vault_id: int = 1,\n  Line 180:             vault_id: The vault ID for the file (defaults to 1)\n  Line 354:         vault_id: int = 1,\n  Line 364:             vault_id: The vault ID to associate the file with (defaults to 1)\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S26.json:\n  Line 1: {\"id\":\"S26\",\"summaryText\":\"[SUMMARY S26] 25.8 KB | code | 623 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S26 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:     - Remove...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S25.json:\n  Line 1: {\"id\":\"S25\",\"summaryText\":\"[SUMMARY S25] 25.8 KB | code | 623 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S25 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:     - Remove...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S24.json:\n  Line 1: {\"id\":\"S24\",\"summaryText\":\"[SUMMARY S24] 25.8 KB | code | 623 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S24 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:     - Remove...\n\nC:\\opencode\\RAGAPPv2\\backend\\app\\models\\database.py:\n  Line 260:         conn.execute(\"UPDATE files SET vault_id = 1 WHERE vault_id IS NULL\")\n  Line 261:         conn.execute(\"UPDATE chat_sessions SET vault_id = 1 WHERE vault_id IS NULL\")\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S55.json:\n  Line 1: {\"id\":\"S55\",\"summaryText\":\"[SUMMARY S55] 25.8 KB | code | 623 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S55 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:     - Remove...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S53.json:\n  Line 1: {\"id\":\"S53\",\"summaryText\":\"[SUMMARY S53] 25.8 KB | code | 623 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n→ Use /swarm retrieve S53 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\api\\\\routes\\\\documents.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Documents API routes for file management and processing.\\n3: \\n4: Provides endpoints for listing documents, uploading files, scanning directories,\\n5: and managing document processing status.\\n6: \\\"\\\"\\\"\\n7: import asyncio\\n8: import hashlib\\n9: import hmac\\n10: import logging\\n11: import os\\n12: import re\\n13: import sqlite3\\n14: from pathlib import Path\\n15: from typing import Any, Dict, List, Optional\\n16: \\n17: import aiofiles\\n18: from fastapi import APIRouter, Depends, HTTPException, Request, UploadFile, File, Query\\n19: from fastapi.exceptions import RequestValidationError\\n20: from pydantic import BaseModel, ConfigDict, Field\\n21: \\n22: from app.config import settings, Settings\\n23: from app.services.document_processor import DocumentProcessor, DocumentProcessingError, DuplicateFileError\\n24: from app.services.vector_store import VectorStore\\n25: from app.services.embeddings import EmbeddingService\\n26: from app.services.secret_manager import SecretManager\\n27: from app.models.database import SQLiteConnectionPool\\n28: from app.api.deps import get_secret_manager, get_background_processor, get_vector_store, get_embedding_service, get_settings, get_db, get_db_pool\\n29: from app.security import csrf_protect, require_scope, require_auth\\n30: from app.limiter import limiter\\n31: from app.services.background_tasks import BackgroundProcessor\\n32: \\n33: \\n34: def secure_filename(filename: str) -> str:\\n35:     \\\"\\\"\\\"\\n36:     Sanitize a filename to prevent security issues.\\n37:     \\n38:     - Strips paths using os.path.basename\\n39:     - Remove...\n\nC:\\opencode\\RAGAPPv2\\backend\\app\\services\\vector_store.py:\n  Line 131:                      metadata, embedding, vault_id (optional, defaults to \"1\").\n  Line 367:         Migration: Backfill vault_id='1' on existing chunks that lack it.\n  Line 413:                 df[\"vault_id\"] = df[\"vault_id\"].fillna(\"1\")\n  Line 453:                 # Add vault_id column with default \"1\"\n  Line 454:                 df[\"vault_id\"] = \"1\"\n\nC:\\opencode\\RAGAPPv2\\backend\\app\\services\\email_service.py:\n  Line 588:         Returns vault_id=1 (default vault) if not found or vault_name is None.\n\nC:\\opencode\\RAGAPPv2\\docs\\email-ingestion.md:\n  Line 377: - Document is routed to **default vault** (vault_id=1)\n  Line 504:                       Use vault_id  Use default vault\n  Line 505:                       from marketing  (vault_id=1)\n  Line 1389: - Document routed to default vault (vault_id=1)\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S21.json:\n  Line 1: {\"id\":\"S21\",\"summaryText\":\"[SUMMARY S21] 25.9 KB | code | 660 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\services\\\\email_service.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Email ingestion service for IMAP-based document processing.\\n3: \\n→ Use /swarm retrieve S21 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\services\\\\email_service.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Email ingestion service for IMAP-based document processing.\\n3: \\n4: Provides EmailIngestionService class that periodically polls an IMAP inbox,\\n5: extracts document attachments, and enqueues them for processing via BackgroundProcessor.\\n6: Supports vault routing via subject tags [VaultName] or #vaultname.\\n7: \\\"\\\"\\\"\\n8: \\n9: import asyncio\\n10: import email\\n11: import email.policy\\n12: import logging\\n13: import os\\n14: import re\\n15: import tempfile\\n16: from datetime import datetime\\n17: from pathlib import Path\\n18: from typing import Optional\\n19: \\n20: import aioimaplib\\n21: import bleach\\n22: from email.message import EmailMessage\\n23: from email.header import decode_header\\n24: \\n25: from app.config import Settings\\n26: from app.models.database import SQLiteConnectionPool\\n27: from app.services.background_tasks import BackgroundProcessor\\n28: \\n29: \\n30: logger = logging.getLogger(__name__)\\n31: \\n32: # Allowed HTML tags for sanitization\\n33: ALLOWED_TAGS = ['p', 'br', 'strong', 'em', 'ul', 'ol', 'li']\\n34: \\n35: # Maximum email size limit (50MB)\\n36: MAX_EMAIL_SIZE = 50 * 1024 * 1024  # 50MB in bytes\\n37: \\n38: # Maximum number of attachments per email (default 10)\\n39: MAX_ATTACHMENTS_PER_EMAIL = 10\\n40: \\n41: \\n42: class EmailIngestionService:\\n43:     \\\"\\\"\\\"\\n44:     Email ingestion service for IMAP-based document processing.\\n45: \\n46:     Periodically polls an IMAP mailbox for UNSEEN emails, extracts document\\n47:     attachments, and enqueues them for processing via BackgroundProcessor.\\n48:     Supports vault routing via ...\n\nC:\\opencode\\RAGAPPv2\\.swarm\\summaries\\S15.json:\n  Line 1: {\"id\":\"S15\",\"summaryText\":\"[SUMMARY S15] 25.9 KB | code | 660 lines\\n<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\services\\\\email_service.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Email ingestion service for IMAP-based document processing.\\n3: \\n→ Use /swarm retrieve S15 for full content\",\"fullOutput\":\"<path>C:\\\\opencode\\\\RAGAPPv2\\\\backend\\\\app\\\\services\\\\email_service.py</path>\\n<type>file</type>\\n<content>1: \\\"\\\"\\\"\\n2: Email ingestion service for IMAP-based document processing.\\n3: \\n4: Provides EmailIngestionService class that periodically polls an IMAP inbox,\\n5: extracts document attachments, and enqueues them for processing via BackgroundProcessor.\\n6: Supports vault routing via subject tags [VaultName] or #vaultname.\\n7: \\\"\\\"\\\"\\n8: \\n9: import asyncio\\n10: import email\\n11: import email.policy\\n12: import logging\\n13: import os\\n14: import re\\n15: import tempfile\\n16: from datetime import datetime\\n17: from pathlib import Path\\n18: from typing import Optional\\n19: \\n20: import aioimaplib\\n21: import bleach\\n22: from email.message import EmailMessage\\n23: from email.header import decode_header\\n24: \\n25: from app.config import Settings\\n26: from app.models.database import SQLiteConnectionPool\\n27: from app.services.background_tasks import BackgroundProcessor\\n28: \\n29: \\n30: logger = logging.getLogger(__name__)\\n31: \\n32: # Allowed HTML tags for sanitization\\n33: ALLOWED_TAGS = ['p', 'br', 'strong', 'em', 'ul', 'ol', 'li']\\n34: \\n35: # Maximum email size limit (50MB)\\n36: MAX_EMAIL_SIZE = 50 * 1024 * 1024  # 50MB in bytes\\n37: \\n38: # Maximum number of attachments per email (default 10)\\n39: MAX_ATTACHMENTS_PER_EMAIL = 10\\n40: \\n41: \\n42: class EmailIngestionService:\\n43:     \\\"\\\"\\\"\\n44:     Email ingestion service for IMAP-based document processing.\\n45: \\n46:     Periodically polls an IMAP mailbox for UNSEEN emails, extracts document\\n47:     attachments, and enqueues them for processing via BackgroundProcessor.\\n48:     Supports vault routing via ...\n\nC:\\opencode\\RAGAPPv2\\backend\\app\\api\\routes\\chat.py:\n  Line 56:     vault_id: int = 1\n\nC:\\opencode\\RAGAPPv2\\backend\\app\\api\\routes\\vaults.py:\n  Line 200:     if vault_id == 1 and request.name is not None:\n  Line 272:     if vault_id == 1:\n\nC:\\opencode\\RAGAPPv2\\backend\\tests\\test_vaults.py:\n  Line 609:         vault_id_1 = self._create_vault(\"Vault1\")\n  Line 650:         vault_id_1 = self._create_vault(\"Vault1\")\n  Line 676:         vault_id_1 = self._create_vault(\"Vault1\")\n  Line 705:         vault_id_1 = self._create_vault(\"Vault1\")\n  Line 732:         vault_id_1 = self._create_vault(\"Vault1\")","timestamp":1771961365154,"originalBytes":44260}