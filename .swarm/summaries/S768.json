{"id":"S768","summaryText":"[SUMMARY S768] 25.8 KB | code | 634 lines\nimport { useState, useEffect, useCallback, useMemo } from \"react\";\nimport { useDropzone, type FileRejection } from \"react-dropzone\";\nimport { toast } from \"sonner\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nâ†’ Use /swarm retrieve S768 for full content","fullOutput":"import { useState, useEffect, useCallback, useMemo } from \"react\";\nimport { useDropzone, type FileRejection } from \"react-dropzone\";\nimport { toast } from \"sonner\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { FileText, Upload, Search, Trash2, ScanLine, AlertCircle, Loader2, X, RotateCcw, Trash } from \"lucide-react\";\nimport { listDocuments, scanDocuments, deleteDocument, deleteDocuments, deleteAllDocumentsInVault, getDocumentStats, type Document, type DocumentStatsResponse } from \"@/lib/api\";\nimport { formatFileSize, formatDate } from \"@/lib/formatters\";\nimport { useDebounce } from \"@/hooks/useDebounce\";\nimport { useVaultStore } from \"@/stores/useVaultStore\";\nimport { useUploadStore } from \"@/stores/useUploadStore\";\nimport { VaultSelector } from \"@/components/vault/VaultSelector\";\nimport { StatusBadge } from \"@/components/shared/StatusBadge\";\nimport { DocumentCard } from \"@/components/shared/DocumentCard\";\nimport { EmptyState } from \"@/components/shared/EmptyState\";\n\nconst MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB\n\nexport default function DocumentsPage() {\n  const [documents, setDocuments] = useState<Document[]>([]);\n  const [stats, setStats] = useState<DocumentStatsResponse | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [debouncedSearchQuery, isSearching] = useDebounce(searchQuery, 300);\n  const [isScanning, setIsScanning] = useState(false);\n  const [rejectedFiles, setRejectedFiles] = useState<string[]>([]);\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n  const [isBulkDeleting, setIsBulkDeleting] = useState(false);\n  const [isBulkDeletingAll, setIsBulkDeletingAll] = useState(false);\n\n  // Global upload store\n  const { uploads, addUploads, cancelUpload, removeUpload, clearCompleted, retryUpload } = useUploadStore();\n  const { activeVaultId } = useVaultStore();\n\n  const fetchDocuments = useCallback(async () => {\n    try {\n      const response = await listDocuments(activeVaultId ?? undefined);\n      setDocuments(response.documents);\n    } catch (err) {\n      console.error(\"Failed to fetch documents:\", err);\n      toast.error(err instanceof Error ? err.message : \"Failed to load documents\");\n    }\n  }, [activeVaultId]);\n\n  const fetchStats = useCallback(async () => {\n    try {\n      const response = await getDocumentStats(activeVaultId ?? undefined);\n      setStats(response);\n    } catch (err) {\n      console.error(\"Failed to fetch stats:\", err);\n      toast.error(err instanceof Error ? err.message : \"Failed to load document stats\");\n    }\n  }, [activeVaultId]);\n\n  useEffect(() => {\n    const loadData = async () => {\n      setLoading(true);\n      await Promise.all([fetchDocuments(), fetchStats()]);\n      setLoading(false);\n    };\n    loadData();\n  }, [fetchDocuments, fetchStats]);\n\n  // Status polling for documents in processing state\n  useEffect(() => {\n    const hasProcessingDocs = documents.some(\n      (doc) => doc.metadata?.status === \"processing\" || doc.metadata?.status === \"pending\"\n    );\n\n    if (!hasProcessingDocs) return;\n\n    const interval = setInterval(() => {\n      fetchDocuments();\n      fetchStats();\n    }, 5000);\n\n    return () => clearInterval(interval);\n  }, [documents, fetchDocuments, fetchStats]);\n\n  // Refresh documents when uploads complete\n  useEffect(() => {\n    const completedCount = uploads.filter((u) => u.status === \"completed\").length;\n    if (completedCount > 0) {\n      // Refresh after a short delay to allow backend processing\n      const timeout = setTimeout(() => {\n        fetchDocuments();\n        fetchStats();\n      }, 1000);\n      return () => clearTimeout(timeout);\n    }\n  }, [uploads, fetchDocuments, fetchStats]);\n\n  // Bulk selection handlers\n  const handleSelectAll = useCallback((checked: boolean | 'indeterminate') => {\n    if (checked) {\n      const allIds = new Set(documents.map((doc) => String(doc.id)));\n      setSelectedIds(allIds);\n    } else {\n      setSelectedIds(new Set());\n    }\n  }, [documents]);\n\n  const handleSelectOne = useCallback((docId: string, checked: boolean) => {\n    setSelectedIds(prev => {\n      const newSet = new Set(prev);\n      if (checked) {\n        newSet.add(docId);\n      } else {\n        newSet.delete(docId);\n      }\n      return newSet;\n    });\n  }, []);\n\n  const handleBulkDelete = useCallback(async () => {\n    if (selectedIds.size === 0) return;\n    \n    const confirmMsg = `Are you sure you want to delete ${selectedIds.size} document${selectedIds.size > 1 ? 's' : ''}?`;\n    if (!window.confirm(confirmMsg)) return;\n\n    setIsBulkDeleting(true);\n\n    try {\n      const result = await deleteDocuments(Array.from(selectedIds));\n      if (result.deleted_count > 0) {\n        toast.success(`Deleted ${result.deleted_count} document${result.deleted_count > 1 ? 's' : ''}`);\n        setDocuments(prev => prev.filter(doc => !selectedIds.has(doc.id)));\n        setStats(prev => prev ? { ...prev, total_documents: Math.max(0, (prev.total_documents ?? 0) - result.deleted_count) } : prev);\n      }\n\n      if (result.failed_ids.length > 0) {\n        toast.error(`Failed to delete ${result.failed_ids.length} document${result.failed_ids.length > 1 ? 's' : ''}`);\n      }\n\n      setSelectedIds(new Set());\n    } catch (err) {\n      toast.error(err instanceof Error ? err.message : \"Failed to delete documents\");\n    } finally {\n      setIsBulkDeleting(false);\n    }\n  }, [selectedIds]);\n\n  const handleDeleteAllInVault = useCallback(async () => {\n    if (documents.length === 0) return;\n    if (!activeVaultId) {\n      toast.error(\"No vault selected\");\n      return;\n    }\n\n    const confirmMsg = `Are you sure you want to delete ALL documents in this vault? This action cannot be undone.`;\n    if (!window.confirm(confirmMsg)) return;\n\n    setIsBulkDeletingAll(true);\n\n    try {\n      const result = await deleteAllDocumentsInVault(activeVaultId);\n      if (result.deleted_count > 0) {\n        toast.success(`Deleted ${result.deleted_count} document${result.deleted_count > 1 ? 's' : ''}`);\n        setDocuments([]);\n        setStats(prev => prev ? { ...prev, total_documents: 0 } : prev);\n      }\n    } catch (err) {\n      toast.error(err instanceof Error ? err.message : \"Failed to delete documents\");\n    } finally {\n      setIsBulkDeletingAll(false);\n    }\n  }, [documents.length, activeVaultId]);\n\n  const onDrop = useCallback((acceptedFiles: File[]) => {\n    if (acceptedFiles.length === 0) return;\n    \n    addUploads(acceptedFiles, activeVaultId ?? undefined);\n    setRejectedFiles([]);\n    toast.success(`Added ${acceptedFiles.length} file(s) to upload queue`);\n  }, [addUploads, activeVaultId]);\n\n  const onDropRejected = useCallback((rejected: FileRejection[]) => {\n    const rejectedNames = rejected.map((r) => `${r.file.name} (${r.errors.map((e) => e.message).join(', ')})`);\n    setRejectedFiles(rejectedNames);\n    rejectedNames.forEach((name) => {\n      toast.error(`File rejected: ${name}`);\n    });\n  }, []);\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    onDropRejected,\n    accept: {\n      'application/pdf': ['.pdf'],\n      'text/plain': ['.txt'],\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ['.docx'],\n      'application/msword': ['.doc'],\n      'text/markdown': ['.md'],\n    },\n    maxSize: MAX_FILE_SIZE,\n  });\n\n  const handleScan = async () => {\n    setIsScanning(true);\n    try {\n      const result = await scanDocuments(activeVaultId ?? undefined);\n      toast.success(`Scan complete: ${result.added} new document(s) added, ${result.scanned} scanned`);\n      await Promise.all([fetchDocuments(), fetchStats()]);\n    } catch (err) {\n      toast.error(err instanceof Error ? err.message : \"Scan failed\");\n    } finally {\n      setIsScanning(false);\n    }\n  };\n\n  const handleDeleteDocument = async (docId: string) => {\n    if (!confirm(\"Are you sure you want to delete this document? This will also remove all associated chunks.\")) return;\n    try {\n      await deleteDocument(docId);\n      toast.success(\"Document deleted successfully\");\n      await Promise.all([fetchDocuments(), fetchStats()]);\n    } catch (err) {\n      toast.error(err instanceof Error ? err.message : \"Failed to delete document\");\n    }\n  };\n\n  const filteredDocuments = useMemo(\n    () => documents.filter((doc) =>\n      doc.filename.toLowerCase().includes(debouncedSearchQuery.toLowerCase())\n    ),\n    [documents, debouncedSearchQuery]\n  );\n\n  return (\n    <div className=\"space-y-6 animate-in fade-in duration-300\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\">Documents</h1>\n          <p className=\"text-muted-foreground mt-1\">Manage your knowledge base documents</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <VaultSelector />\n          <Button onClick={handleScan} disabled={isScanning}>\n            {isScanning ? (\n              <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n            ) : (\n              <ScanLine className=\"w-4 h-4 mr-2\" />\n            )}\n            Scan Directory\n          </Button>\n          {filteredDocuments.length > 0 && (\n            <Button \n              variant=\"destructive\" \n              onClick={handleDeleteAllInVault} \n              disabled={isBulkDeletingAll}\n            >\n              {isBulkDeletingAll ? (\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n              ) : (\n                <Trash className=\"w-4 h-4 mr-2\" />\n              )}\n              Delete All in Vault\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {stats && (\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardDescription>Total Documents</CardDescription>\n              <CardTitle className=\"text-3xl\">{stats.total_documents}</CardTitle>\n            </CardHeader>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardDescription>Total Chunks</CardDescription>\n              <CardTitle className=\"text-3xl\">{stats.total_chunks}</CardTitle>\n            </CardHeader>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardDescription>Total Size</CardDescription>\n              <CardTitle className=\"text-3xl\">{formatFileSize(stats.total_size_bytes)}</CardTitle>\n            </CardHeader>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardDescription>Processed</CardDescription>\n              <CardTitle className=\"text-3xl\">{stats.documents_by_status?.processed || 0}</CardTitle>\n            </CardHeader>\n          </Card>\n        </div>\n      )}\n\n      <Card\n        {...getRootProps()}\n        className={`border-2 border-dashed cursor-pointer transition-colors ${\n          isDragActive ? \"border-primary bg-primary/5\" : \"border-border\"\n        }`}\n      >\n        <input {...getInputProps()} />\n        <CardContent className=\"py-8\">\n          <div className=\"flex flex-col items-center justify-center text-center\">\n            <Upload className=\"w-12 h-12 text-muted-foreground mb-4\" />\n            <p className=\"text-lg font-medium\">\n              {isDragActive ? \"Drop files here...\" : \"Drag & drop files here, or click to select\"}\n            </p>\n            <p className=\"text-sm text-muted-foreground mt-1\">\n              Supports PDF, DOCX, TXT, MD files (max 50MB each). Uploads continue in background.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Upload Queue */}\n      {uploads.length > 0 && (\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between\">\n            <div>\n              <CardTitle className=\"text-sm\">Upload Queue</CardTitle>\n              <CardDescription>\n                {uploads.filter((u) => u.status === \"pending\").length} pending,{\" \"}\n                {uploads.filter((u) => u.status === \"uploading\").length} uploading,{\" \"}\n                {uploads.filter((u) => u.status === \"completed\").length} completed\n              </CardDescription>\n            </div>\n            {uploads.some((u) => u.status === \"completed\" || u.status === \"error\" || u.status === \"cancelled\") && (\n              <Button variant=\"ghost\" size=\"sm\" onClick={clearCompleted}>\n                Clear Completed\n              </Button>\n            )}\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {uploads.map((upload) => (\n              <div key={upload.id} className=\"space-y-2\">\n                <div className=\"flex justify-between items-center text-sm\">\n                  <span className=\"truncate max-w-[250px]\" title={upload.file.name}>\n                    {upload.file.name}\n                  </span>\n                  <div className=\"flex items-center gap-2\">\n                    {upload.status === \"completed\" && (\n                      <span className=\"text-green-500 text-xs\">Done</span>\n                    )}\n                    {upload.status === \"error\" && (\n                      <span className=\"text-destructive text-xs\" title={upload.error}>\n                        Error\n                      </span>\n                    )}\n                    {upload.status === \"cancelled\" && (\n                      <span className=\"text-muted-foreground text-xs\">Cancelled</span>\n                    )}\n                    {upload.status === \"pending\" && (\n                      <span className=\"text-muted-foreground text-xs\">Pending</span>\n                    )}\n                    {upload.status === \"uploading\" && (\n                      <span className=\"text-muted-foreground text-xs\">\n                        {upload.progress > 0 ? `${upload.progress}%` : \"Uploading...\"}\n                      </span>\n                    )}\n                    \n                    {upload.status === \"pending\" && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-7 w-7\"\n                        onClick={() => cancelUpload(upload.id)}\n                        aria-label={`Cancel upload for ${upload.file.name}`}\n                      >\n                        <X className=\"w-3 h-3\" />\n                      </Button>\n                    )}\n                    {upload.status === \"error\" && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-7 w-7\"\n                        onClick={() => retryUpload(upload.id)}\n                        aria-label={`Retry upload for ${upload.file.name}`}\n                      >\n                        <RotateCcw className=\"w-3 h-3\" />\n                      </Button>\n                    )}\n                    {(upload.status === \"completed\" || upload.status === \"cancelled\" || upload.status === \"error\") && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-7 w-7\"\n                        onClick={() => removeUpload(upload.id)}\n                        aria-label={`Remove ${upload.file.name} from queue`}\n                      >\n                        <X className=\"w-3 h-3\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n                {upload.status === \"uploading\" && (\n                  <Progress value={upload.progress} className=\"h-1.5\" />\n                )}\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      )}\n\n      {rejectedFiles.length > 0 && (\n        <div className=\"p-4 bg-amber-500/10 text-amber-700 rounded-lg\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <AlertCircle className=\"w-5 h-5\" />\n            <span className=\"font-medium\">Some files were rejected:</span>\n          </div>\n          <ul className=\"list-disc pl-5 space-y-1\">\n            {rejectedFiles.map((file, index) => (\n              <li key={index} className=\"text-sm\">{file}</li>\n            ))}\n          </ul>\n        </div>\n      )}\n\n      <div className=\"flex items-center gap-4\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search documents...\"\n            className=\"pl-10\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n          />\n          {isSearching && (\n            <Loader2 className=\"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground animate-spin\" />\n          )}\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {selectedIds.size > 0 && (\n            <>\n              <Badge variant=\"outline\">{selectedIds.size} selected</Badge>\n              <Button \n                variant=\"destructive\" \n                size=\"sm\"\n                onClick={handleBulkDelete}\n                disabled={isBulkDeleting}\n              >\n                {isBulkDeleting ? (\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                ) : (\n                  <Trash2 className=\"w-4 h-4 mr-2\" />\n                )}\n                Delete Selected\n              </Button>\n            </>\n          )}\n          <Badge variant=\"secondary\">{filteredDocuments.length} documents</Badge>\n        </div>\n      </div>\n\n      {loading ? (\n        <>\n          {/* Desktop Table Skeleton (hidden on mobile) */}\n          <Card className=\"hidden sm:block\">\n            <CardContent className=\"p-0\">\n              <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <caption className=\"sr-only\">Documents List</caption>\n                <thead>\n                  <tr className=\"border-b bg-muted/50\">\n                    <th scope=\"col\" className=\"text-left p-4 font-medium\">\n                      <Checkbox disabled aria-label=\"Select all documents\" />\n                    </th>\n                    <th scope=\"col\" className=\"text-left p-4 font-medium\">Filename</th>\n                    <th scope=\"col\" className=\"text-left p-4 font-medium\">Status</th>\n                    <th scope=\"col\" className=\"text-left p-4 font-medium\">Chunks</th>\n                    <th scope=\"col\" className=\"text-left p-4 font-medium\">Size</th>\n                    <th scope=\"col\" className=\"text-left p-4 font-medium\">Uploaded</th>\n                    <th scope=\"col\" className=\"text-right p-4 font-medium\">Actions</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {[...Array(5)].map((_, i) => (\n                    <tr key={i} className=\"border-b\">\n                      <td className=\"p-4\">\n                        <Checkbox disabled />\n                      </td>\n                      <td className=\"p-4\">\n                        <div className=\"flex items-center gap-2\">\n                          <Skeleton className=\"h-4 w-4\" />\n                          <Skeleton className=\"h-4 w-[180px]\" />\n                        </div>\n                      </td>\n                      <td className=\"p-4\"><Skeleton className=\"h-5 w-[80px]\" /></td>\n                      <td className=\"p-4\"><Skeleton className=\"h-4 w-[40px]\" /></td>\n                      <td className=\"p-4\"><Skeleton className=\"h-4 w-[60px]\" /></td>\n                      <td className=\"p-4\"><Skeleton className=\"h-4 w-[80px]\" /></td>\n                      <td className=\"p-4 text-right\"><Skeleton className=\"h-11 w-11 ml-auto\" /></td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Mobile Cards Skeleton (hidden on desktop) */}\n          <div className=\"grid grid-cols-1 gap-3 sm:hidden\">\n            {[...Array(3)].map((_, i) => (\n              <Card key={i} className=\"w-full\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start justify-between gap-3 mb-3\">\n                    <div className=\"flex items-center gap-3 min-w-0 flex-1\">\n                      <Skeleton className=\"h-11 w-11 rounded-md\" />\n                      <div className=\"min-w-0\">\n                        <Skeleton className=\"h-5 w-32 mb-1\" />\n                        <Skeleton className=\"h-4 w-24\" />\n                      </div>\n                    </div>\n                    <Skeleton className=\"h-11 w-11 rounded-full\" />\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                    <div className=\"space-y-1\">\n                      <Skeleton className=\"h-4 w-16\" />\n                      <Skeleton className=\"h-6 w-20\" />\n                    </div>\n                    <div className=\"space-y-1\">\n                      <Skeleton className=\"h-4 w-16\" />\n                      <Skeleton className=\"h-4 w-16\" />\n                    </div>\n                    <div className=\"space-y-1\">\n                      <Skeleton className=\"h-4 w-16\" />\n                      <Skeleton className=\"h-4 w-20\" />\n                    </div>\n                    <div className=\"space-y-1\">\n                      <Skeleton className=\"h-4 w-16\" />\n                      <Skeleton className=\"h-4 w-12\" />\n                    </div>\n                  </div>\n                  <div className=\"mt-4 flex sm:hidden\">\n                    <Skeleton className=\"h-11 w-full rounded-md\" />\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </>\n      ) : filteredDocuments.length === 0 ? (\n        <EmptyState\n          icon={FileText}\n          title={searchQuery ? \"No documents match your search\" : \"No documents yet\"}\n          description={searchQuery ? undefined : \"Upload some files to get started.\"}\n        />\n      ) : (\n        <>\n          {/* Desktop Table View (hidden on mobile) */}\n          <Card className=\"hidden sm:block\">\n            <CardContent className=\"p-0\">\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full\">\n                  <caption className=\"sr-only\">Documents List</caption>\n                  <thead>\n                    <tr className=\"border-b bg-muted/50\">\n                      <th scope=\"col\" className=\"text-left p-4 font-medium\">\n                        <Checkbox \n                          checked={selectedIds.size > 0 && selectedIds.size === filteredDocuments.length}\n                          onCheckedChange={handleSelectAll}\n                          aria-label=\"Select all documents\"\n                        />\n                      </th>\n                      <th scope=\"col\" className=\"text-left p-4 font-medium\">Filename</th>\n                      <th scope=\"col\" className=\"text-left p-4 font-medium\">Status</th>\n                      <th scope=\"col\" className=\"text-left p-4 font-medium\">Chunks</th>\n                      <th scope=\"col\" className=\"text-left p-4 font-medium\">Size</th>\n                      <th scope=\"col\" className=\"text-left p-4 font-medium\">Uploaded</th>\n                      <th scope=\"col\" className=\"text-right p-4 font-medium\">Actions</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {filteredDocuments.map((doc) => {\n                      const docId = String(doc.id);\n                      const isSelected = selectedIds.has(docId);\n                      return (\n                        <tr key={doc.id} className={`border-b hover:bg-muted/50 ${isSelected ? 'bg-muted/30' : ''}`}>\n                          <td className=\"p-4\">\n                            <Checkbox \n                              checked={isSelected}\n                              onCheckedChange={(checked) => handleSelectOne(String(doc.id), !!checked)}\n                              aria-label={`Select ${doc.filename}`}\n                            />\n                          </td>\n                          <td className=\"p-4\">\n                            <div className=\"flex items-center gap-2\">\n                              <FileText className=\"w-4 h-4 text-muted-foreground\" />\n                              <span className=\"font-medium truncate max-w-[200px]\">{doc.filename}</span>\n                            </div>\n                          </td>\n                          <td className=\"p-4\"><StatusBadge status={doc.metadata?.status as string} /></td>\n                          <td className=\"p-4\">{String(doc.metadata?.chunk_count ?? 0)}</td>\n                          <td className=\"p-4\">{formatFileSize(doc.size)}</td>\n                          <td className=\"p-4 text-muted-foreground\">{formatDate(doc.created_at)}</td>\n                          <td className=\"p-4 text-right\">\n                            <Button \n                              variant=\"ghost\" \n                              size=\"icon\" \n                              className=\"min-w-[44px] min-h-[44px]\" \n                              onClick={() => handleDeleteDocument(String(doc.id))}\n                            >\n                              <Trash2 className=\"w-4 h-4 text-destructive\" />\n                            </Button>\n                          </td>\n                        </tr>\n                      );\n                    })}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n\n           {/* Mobile Cards View (hidden on desktop) */}\n           <div className=\"grid grid-cols-1 gap-3 sm:hidden\">\n             {filteredDocuments.map((doc) => (\n               <DocumentCard\n                 key={doc.id}\n                 document={doc}\n                 onDelete={(id) => handleDeleteDocument(String(id))}\n                 isSelected={selectedIds.has(doc.id)}\n                 onSelectionChange={handleSelectOne}\n               />\n             ))}\n           </div>\n        </>\n      )}\n    </div>\n  );\n}\n","timestamp":1771946397215,"originalBytes":26461}