{"id":"S10","summaryText":"[SUMMARY S10] 30.8 KB | code | 674 lines\n<path>C:\\opencode\\RAGAPPv2\\frontend\\src\\pages\\DocumentsPage.tsx</path>\n<type>file</type>\n<content>1: import { useState, useEffect, useCallback, useMemo, useRef } from \"react\";\n2: import { useDropzone, type FileRejection } from \"react-dropzone\";\n3: import { toast } from \"sonner\";\nâ†’ Use /swarm retrieve S10 for full content","fullOutput":"<path>C:\\opencode\\RAGAPPv2\\frontend\\src\\pages\\DocumentsPage.tsx</path>\n<type>file</type>\n<content>1: import { useState, useEffect, useCallback, useMemo, useRef } from \"react\";\n2: import { useDropzone, type FileRejection } from \"react-dropzone\";\n3: import { toast } from \"sonner\";\n4: import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\n5: import { Button } from \"@/components/ui/button\";\n6: import { Input } from \"@/components/ui/input\";\n7: import { Badge } from \"@/components/ui/badge\";\n8: import { Progress } from \"@/components/ui/progress\";\n9: import { Skeleton } from \"@/components/ui/skeleton\";\n10: import { Checkbox } from \"@/components/ui/checkbox\";\n11: import { FileText, Upload, Search, Trash2, ScanLine, AlertCircle, Loader2, X, RotateCcw, Trash } from \"lucide-react\";\n12: import { listDocuments, scanDocuments, deleteDocument, deleteDocuments, deleteAllDocumentsInVault, getDocumentStats, type Document, type DocumentStatsResponse } from \"@/lib/api\";\n13: import { formatFileSize, formatDate } from \"@/lib/formatters\";\n14: import { useDebounce } from \"@/hooks/useDebounce\";\n15: import { useVaultStore } from \"@/stores/useVaultStore\";\n16: import { useUploadStore } from \"@/stores/useUploadStore\";\n17: import { VaultSelector } from \"@/components/vault/VaultSelector\";\n18: import { StatusBadge } from \"@/components/shared/StatusBadge\";\n19: import { DocumentCard } from \"@/components/shared/DocumentCard\";\n20: import { EmptyState } from \"@/components/shared/EmptyState\";\n21: \n22: const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB\n23: \n24: export default function DocumentsPage() {\n25:   const [documents, setDocuments] = useState<Document[]>([]);\n26:   const [stats, setStats] = useState<DocumentStatsResponse | null>(null);\n27:   const [loading, setLoading] = useState(true);\n28:   const [searchQuery, setSearchQuery] = useState(\"\");\n29:   const [debouncedSearchQuery, isSearching] = useDebounce(searchQuery, 300);\n30:   const [isScanning, setIsScanning] = useState(false);\n31:   const [rejectedFiles, setRejectedFiles] = useState<string[]>([]);\n32:   const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n33:   const [isBulkDeleting, setIsBulkDeleting] = useState(false);\n34:   const [isBulkDeletingAll, setIsBulkDeletingAll] = useState(false);\n35:   const [filenameColWidth, setFilenameColWidth] = useState<number>(250);\n36:   const dragState = useRef<{ startX: number; startWidth: number }>({ startX: 0, startWidth: 0 });\n37: \n38:   // Global upload store\n39:   const { uploads, addUploads, cancelUpload, removeUpload, clearCompleted, retryUpload } = useUploadStore();\n40:   const { activeVaultId } = useVaultStore();\n41: \n42:   const fetchDocuments = useCallback(async () => {\n43:     try {\n44:       const response = await listDocuments(activeVaultId ?? undefined);\n45:       setDocuments(response.documents);\n46:     } catch (err) {\n47:       console.error(\"Failed to fetch documents:\", err);\n48:       toast.error(err instanceof Error ? err.message : \"Failed to load documents\");\n49:     }\n50:   }, [activeVaultId]);\n51: \n52:   const fetchStats = useCallback(async () => {\n53:     try {\n54:       const response = await getDocumentStats(activeVaultId ?? undefined);\n55:       setStats(response);\n56:     } catch (err) {\n57:       console.error(\"Failed to fetch stats:\", err);\n58:       toast.error(err instanceof Error ? err.message : \"Failed to load document stats\");\n59:     }\n60:   }, [activeVaultId]);\n61: \n62:   const handleResizeMouseDown = useCallback((e: React.MouseEvent<HTMLDivElement>) => {\n63:     e.preventDefault();\n64:     dragState.current = { startX: e.clientX, startWidth: filenameColWidth };\n65:     document.body.style.cursor = 'col-resize';\n66: \n67:     const handleMouseMove = (moveEvent: MouseEvent) => {\n68:       const deltaX = moveEvent.clientX - dragState.current.startX;\n69:       const newWidth = Math.max(120, Math.min(600, dragState.current.startWidth + deltaX));\n70:       setFilenameColWidth(newWidth);\n71:     };\n72: \n73:     const handleMouseUp = () => {\n74:       document.body.style.cursor = '';\n75:       document.removeEventListener('mousemove', handleMouseMove);\n76:       document.removeEventListener('mouseup', handleMouseUp);\n77:     };\n78: \n79:     document.addEventListener('mousemove', handleMouseMove);\n80:     document.addEventListener('mouseup', handleMouseUp);\n81:   }, [filenameColWidth]);\n82: \n83:   useEffect(() => {\n84:     const loadData = async () => {\n85:       setLoading(true);\n86:       await Promise.all([fetchDocuments(), fetchStats()]);\n87:       setLoading(false);\n88:     };\n89:     loadData();\n90:   }, [fetchDocuments, fetchStats]);\n91: \n92:   // Status polling for documents in processing state\n93:   useEffect(() => {\n94:     const hasProcessingDocs = documents.some(\n95:       (doc) => doc.metadata?.status === \"processing\" || doc.metadata?.status === \"pending\"\n96:     );\n97: \n98:     if (!hasProcessingDocs) return;\n99: \n100:     const interval = setInterval(() => {\n101:       fetchDocuments();\n102:       fetchStats();\n103:     }, 5000);\n104: \n105:     return () => clearInterval(interval);\n106:   }, [documents, fetchDocuments, fetchStats]);\n107: \n108:   // Refresh documents when uploads complete\n109:   useEffect(() => {\n110:     const completedCount = uploads.filter((u) => u.status === \"completed\").length;\n111:     if (completedCount > 0) {\n112:       // Refresh after a short delay to allow backend processing\n113:       const timeout = setTimeout(() => {\n114:         fetchDocuments();\n115:         fetchStats();\n116:       }, 1000);\n117:       return () => clearTimeout(timeout);\n118:     }\n119:   }, [uploads, fetchDocuments, fetchStats]);\n120: \n121:   // Bulk selection handlers\n122:   const handleSelectAll = useCallback((checked: boolean | 'indeterminate') => {\n123:     if (checked) {\n124:       const allIds = new Set(documents.map((doc) => String(doc.id)));\n125:       setSelectedIds(allIds);\n126:     } else {\n127:       setSelectedIds(new Set());\n128:     }\n129:   }, [documents]);\n130: \n131:   const handleSelectOne = useCallback((docId: string, checked: boolean) => {\n132:     setSelectedIds(prev => {\n133:       const newSet = new Set(prev);\n134:       if (checked) {\n135:         newSet.add(docId);\n136:       } else {\n137:         newSet.delete(docId);\n138:       }\n139:       return newSet;\n140:     });\n141:   }, []);\n142: \n143:   const handleBulkDelete = useCallback(async () => {\n144:     if (selectedIds.size === 0) return;\n145:     \n146:     const confirmMsg = `Are you sure you want to delete ${selectedIds.size} document${selectedIds.size > 1 ? 's' : ''}?`;\n147:     if (!window.confirm(confirmMsg)) return;\n148: \n149:     setIsBulkDeleting(true);\n150: \n151:     try {\n152:       const result = await deleteDocuments(Array.from(selectedIds));\n153:       if (result.deleted_count > 0) {\n154:         toast.success(`Deleted ${result.deleted_count} document${result.deleted_count > 1 ? 's' : ''}`);\n155:         setDocuments(prev => prev.filter(doc => !selectedIds.has(doc.id)));\n156:         setStats(prev => prev ? { ...prev, total_documents: Math.max(0, (prev.total_documents ?? 0) - result.deleted_count) } : prev);\n157:       }\n158: \n159:       if (result.failed_ids.length > 0) {\n160:         toast.error(`Failed to delete ${result.failed_ids.length} document${result.failed_ids.length > 1 ? 's' : ''}`);\n161:       }\n162: \n163:       setSelectedIds(new Set());\n164:     } catch (err) {\n165:       toast.error(err instanceof Error ? err.message : \"Failed to delete documents\");\n166:     } finally {\n167:       setIsBulkDeleting(false);\n168:     }\n169:   }, [selectedIds]);\n170: \n171:   const handleDeleteAllInVault = useCallback(async () => {\n172:     if (documents.length === 0) return;\n173:     if (!activeVaultId) {\n174:       toast.error(\"No vault selected\");\n175:       return;\n176:     }\n177: \n178:     const confirmMsg = `Are you sure you want to delete ALL documents in this vault? This action cannot be undone.`;\n179:     if (!window.confirm(confirmMsg)) return;\n180: \n181:     setIsBulkDeletingAll(true);\n182: \n183:     try {\n184:       const result = await deleteAllDocumentsInVault(activeVaultId);\n185:       if (result.deleted_count > 0) {\n186:         toast.success(`Deleted ${result.deleted_count} document${result.deleted_count > 1 ? 's' : ''}`);\n187:         setDocuments([]);\n188:         setStats(prev => prev ? { ...prev, total_documents: 0 } : prev);\n189:       }\n190:     } catch (err) {\n191:       toast.error(err instanceof Error ? err.message : \"Failed to delete documents\");\n192:     } finally {\n193:       setIsBulkDeletingAll(false);\n194:     }\n195:   }, [documents.length, activeVaultId]);\n196: \n197:   const onDrop = useCallback((acceptedFiles: File[]) => {\n198:     if (acceptedFiles.length === 0) return;\n199:     \n200:     addUploads(acceptedFiles, activeVaultId ?? undefined);\n201:     setRejectedFiles([]);\n202:     toast.success(`Added ${acceptedFiles.length} file(s) to upload queue`);\n203:   }, [addUploads, activeVaultId]);\n204: \n205:   const onDropRejected = useCallback((rejected: FileRejection[]) => {\n206:     const rejectedNames = rejected.map((r) => `${r.file.name} (${r.errors.map((e) => e.message).join(', ')})`);\n207:     setRejectedFiles(rejectedNames);\n208:     rejectedNames.forEach((name) => {\n209:       toast.error(`File rejected: ${name}`);\n210:     });\n211:   }, []);\n212: \n213:   const { getRootProps, getInputProps, isDragActive } = useDropzone({\n214:     onDrop,\n215:     onDropRejected,\n216:     accept: {\n217:       'application/pdf': ['.pdf'],\n218:       'text/plain': ['.txt'],\n219:       'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ['.docx'],\n220:       'application/msword': ['.doc'],\n221:       'text/markdown': ['.md'],\n222:     },\n223:     maxSize: MAX_FILE_SIZE,\n224:   });\n225: \n226:   const handleScan = async () => {\n227:     setIsScanning(true);\n228:     try {\n229:       const result = await scanDocuments(activeVaultId ?? undefined);\n230:       toast.success(`Scan complete: ${result.added} new document(s) added, ${result.scanned} scanned`);\n231:       await Promise.all([fetchDocuments(), fetchStats()]);\n232:     } catch (err) {\n233:       toast.error(err instanceof Error ? err.message : \"Scan failed\");\n234:     } finally {\n235:       setIsScanning(false);\n236:     }\n237:   };\n238: \n239:   const handleDeleteDocument = async (docId: string) => {\n240:     if (!confirm(\"Are you sure you want to delete this document? This will also remove all associated chunks.\")) return;\n241:     try {\n242:       await deleteDocument(docId);\n243:       toast.success(\"Document deleted successfully\");\n244:       await Promise.all([fetchDocuments(), fetchStats()]);\n245:     } catch (err) {\n246:       toast.error(err instanceof Error ? err.message : \"Failed to delete document\");\n247:     }\n248:   };\n249: \n250:   const filteredDocuments = useMemo(\n251:     () => documents.filter((doc) =>\n252:       doc.filename.toLowerCase().includes(debouncedSearchQuery.toLowerCase())\n253:     ),\n254:     [documents, debouncedSearchQuery]\n255:   );\n256: \n257:   return (\n258:     <div className=\"space-y-6 animate-in fade-in duration-300\">\n259:       <div className=\"flex items-center justify-between\">\n260:         <div>\n261:           <h1 className=\"text-3xl font-bold tracking-tight\">Documents</h1>\n262:           <p className=\"text-muted-foreground mt-1\">Manage your knowledge base documents</p>\n263:         </div>\n264:         <div className=\"flex items-center gap-2\">\n265:           <VaultSelector />\n266:           <Button onClick={handleScan} disabled={isScanning}>\n267:             {isScanning ? (\n268:               <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n269:             ) : (\n270:               <ScanLine className=\"w-4 h-4 mr-2\" />\n271:             )}\n272:             Scan Directory\n273:           </Button>\n274:           {filteredDocuments.length > 0 && (\n275:             <Button \n276:               variant=\"destructive\" \n277:               onClick={handleDeleteAllInVault} \n278:               disabled={isBulkDeletingAll}\n279:             >\n280:               {isBulkDeletingAll ? (\n281:                 <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n282:               ) : (\n283:                 <Trash className=\"w-4 h-4 mr-2\" />\n284:               )}\n285:               Delete All in Vault\n286:             </Button>\n287:           )}\n288:         </div>\n289:       </div>\n290: \n291:       {stats && (\n292:         <div className=\"grid gap-4 md:grid-cols-4\">\n293:           <Card>\n294:             <CardHeader className=\"pb-2\">\n295:               <CardDescription>Total Documents</CardDescription>\n296:               <CardTitle className=\"text-3xl\">{stats.total_documents}</CardTitle>\n297:             </CardHeader>\n298:           </Card>\n299:           <Card>\n300:             <CardHeader className=\"pb-2\">\n301:               <CardDescription>Total Chunks</CardDescription>\n302:               <CardTitle className=\"text-3xl\">{stats.total_chunks}</CardTitle>\n303:             </CardHeader>\n304:           </Card>\n305:           <Card>\n306:             <CardHeader className=\"pb-2\">\n307:               <CardDescription>Total Size</CardDescription>\n308:               <CardTitle className=\"text-3xl\">{formatFileSize(stats.total_size_bytes)}</CardTitle>\n309:             </CardHeader>\n310:           </Card>\n311:           <Card>\n312:             <CardHeader className=\"pb-2\">\n313:               <CardDescription>Processed</CardDescription>\n314:               <CardTitle className=\"text-3xl\">{stats.documents_by_status?.processed || 0}</CardTitle>\n315:             </CardHeader>\n316:           </Card>\n317:         </div>\n318:       )}\n319: \n320:       <Card\n321:         {...getRootProps()}\n322:         className={`border-2 border-dashed cursor-pointer transition-colors ${\n323:           isDragActive ? \"border-primary bg-primary/5\" : \"border-border\"\n324:         }`}\n325:       >\n326:         <input {...getInputProps()} />\n327:         <CardContent className=\"py-8\">\n328:           <div className=\"flex flex-col items-center justify-center text-center\">\n329:             <Upload className=\"w-12 h-12 text-muted-foreground mb-4\" />\n330:             <p className=\"text-lg font-medium\">\n331:               {isDragActive ? \"Drop files here...\" : \"Drag & drop files here, or click to select\"}\n332:             </p>\n333:             <p className=\"text-sm text-muted-foreground mt-1\">\n334:               Supports PDF, DOCX, TXT, MD files (max 50MB each). Uploads continue in background.\n335:             </p>\n336:           </div>\n337:         </CardContent>\n338:       </Card>\n339: \n340:       {/* Upload Queue */}\n341:       {uploads.length > 0 && (\n342:         <Card>\n343:           <CardHeader className=\"flex flex-row items-center justify-between\">\n344:             <div>\n345:               <CardTitle className=\"text-sm\">Upload Queue</CardTitle>\n346:               <CardDescription>\n347:                 {uploads.filter((u) => u.status === \"pending\").length} pending,{\" \"}\n348:                 {uploads.filter((u) => u.status === \"uploading\").length} uploading,{\" \"}\n349:                 {uploads.filter((u) => u.status === \"completed\").length} completed\n350:               </CardDescription>\n351:             </div>\n352:             {uploads.some((u) => u.status === \"completed\" || u.status === \"error\" || u.status === \"cancelled\") && (\n353:               <Button variant=\"ghost\" size=\"sm\" onClick={clearCompleted}>\n354:                 Clear Completed\n355:               </Button>\n356:             )}\n357:           </CardHeader>\n358:           <CardContent className=\"space-y-3\">\n359:             {uploads.map((upload) => (\n360:               <div key={upload.id} className=\"space-y-2\">\n361:                 <div className=\"flex justify-between items-center text-sm\">\n362:                   <span className=\"truncate max-w-[250px]\" title={upload.file.name}>\n363:                     {upload.file.name}\n364:                   </span>\n365:                   <div className=\"flex items-center gap-2\">\n366:                     {upload.status === \"completed\" && (\n367:                       <span className=\"text-green-500 text-xs\">Done</span>\n368:                     )}\n369:                     {upload.status === \"error\" && (\n370:                       <span className=\"text-destructive text-xs\" title={upload.error}>\n371:                         Error\n372:                       </span>\n373:                     )}\n374:                     {upload.status === \"cancelled\" && (\n375:                       <span className=\"text-muted-foreground text-xs\">Cancelled</span>\n376:                     )}\n377:                     {upload.status === \"pending\" && (\n378:                       <span className=\"text-muted-foreground text-xs\">Pending</span>\n379:                     )}\n380:                     {upload.status === \"uploading\" && (\n381:                       <span className=\"text-muted-foreground text-xs\">\n382:                         {upload.progress > 0 ? `${upload.progress}%` : \"Uploading...\"}\n383:                       </span>\n384:                     )}\n385:                     \n386:                     {upload.status === \"pending\" && (\n387:                       <Button\n388:                         variant=\"ghost\"\n389:                         size=\"icon\"\n390:                         className=\"h-7 w-7\"\n391:                         onClick={() => cancelUpload(upload.id)}\n392:                         aria-label={`Cancel upload for ${upload.file.name}`}\n393:                       >\n394:                         <X className=\"w-3 h-3\" />\n395:                       </Button>\n396:                     )}\n397:                     {upload.status === \"error\" && (\n398:                       <Button\n399:                         variant=\"ghost\"\n400:                         size=\"icon\"\n401:                         className=\"h-7 w-7\"\n402:                         onClick={() => retryUpload(upload.id)}\n403:                         aria-label={`Retry upload for ${upload.file.name}`}\n404:                       >\n405:                         <RotateCcw className=\"w-3 h-3\" />\n406:                       </Button>\n407:                     )}\n408:                     {(upload.status === \"completed\" || upload.status === \"cancelled\" || upload.status === \"error\") && (\n409:                       <Button\n410:                         variant=\"ghost\"\n411:                         size=\"icon\"\n412:                         className=\"h-7 w-7\"\n413:                         onClick={() => removeUpload(upload.id)}\n414:                         aria-label={`Remove ${upload.file.name} from queue`}\n415:                       >\n416:                         <X className=\"w-3 h-3\" />\n417:                       </Button>\n418:                     )}\n419:                   </div>\n420:                 </div>\n421:                 {upload.status === \"uploading\" && (\n422:                   <Progress value={upload.progress} className=\"h-1.5\" />\n423:                 )}\n424:               </div>\n425:             ))}\n426:           </CardContent>\n427:         </Card>\n428:       )}\n429: \n430:       {rejectedFiles.length > 0 && (\n431:         <div className=\"p-4 bg-amber-500/10 text-amber-700 rounded-lg\">\n432:           <div className=\"flex items-center gap-2 mb-2\">\n433:             <AlertCircle className=\"w-5 h-5\" />\n434:             <span className=\"font-medium\">Some files were rejected:</span>\n435:           </div>\n436:           <ul className=\"list-disc pl-5 space-y-1\">\n437:             {rejectedFiles.map((file, index) => (\n438:               <li key={index} className=\"text-sm\">{file}</li>\n439:             ))}\n440:           </ul>\n441:         </div>\n442:       )}\n443: \n444:       <div className=\"flex items-center gap-4\">\n445:         <div className=\"relative flex-1 max-w-md\">\n446:           <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n447:           <Input\n448:             placeholder=\"Search documents...\"\n449:             className=\"pl-10\"\n450:             value={searchQuery}\n451:             onChange={(e) => setSearchQuery(e.target.value)}\n452:           />\n453:           {isSearching && (\n454:             <Loader2 className=\"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground animate-spin\" />\n455:           )}\n456:         </div>\n457:         <div className=\"flex items-center gap-2\">\n458:           {selectedIds.size > 0 && (\n459:             <>\n460:               <Badge variant=\"outline\">{selectedIds.size} selected</Badge>\n461:               <Button \n462:                 variant=\"destructive\" \n463:                 size=\"sm\"\n464:                 onClick={handleBulkDelete}\n465:                 disabled={isBulkDeleting}\n466:               >\n467:                 {isBulkDeleting ? (\n468:                   <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n469:                 ) : (\n470:                   <Trash2 className=\"w-4 h-4 mr-2\" />\n471:                 )}\n472:                 Delete Selected\n473:               </Button>\n474:             </>\n475:           )}\n476:           <Badge variant=\"secondary\">{filteredDocuments.length} documents</Badge>\n477:         </div>\n478:       </div>\n479: \n480:       {loading ? (\n481:         <>\n482:           {/* Desktop Table Skeleton (hidden on mobile) */}\n483:           <Card className=\"hidden sm:block\">\n484:             <CardContent className=\"p-0\">\n485:               <div className=\"overflow-x-auto\">\n486:               <table className=\"w-full\">\n487:                 <caption className=\"sr-only\">Documents List</caption>\n488:                 <thead>\n489:                   <tr className=\"border-b bg-muted/50\">\n490:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">\n491:                       <Checkbox disabled aria-label=\"Select all documents\" />\n492:                     </th>\n493:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">Filename</th>\n494:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">Status</th>\n495:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">Chunks</th>\n496:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">Size</th>\n497:                     <th scope=\"col\" className=\"text-left p-4 font-medium\">Uploaded</th>\n498:                     <th scope=\"col\" className=\"text-right p-4 font-medium\">Actions</th>\n499:                   </tr>\n500:                 </thead>\n501:                 <tbody>\n502:                   {[...Array(5)].map((_, i) => (\n503:                     <tr key={i} className=\"border-b\">\n504:                       <td className=\"p-4\">\n505:                         <Checkbox disabled />\n506:                       </td>\n507:                       <td className=\"p-4\">\n508:                         <div className=\"flex items-center gap-2\">\n509:                           <Skeleton className=\"h-4 w-4\" />\n510:                           <Skeleton className=\"h-4 w-[180px]\" />\n511:                         </div>\n512:                       </td>\n513:                       <td className=\"p-4\"><Skeleton className=\"h-5 w-[80px]\" /></td>\n514:                       <td className=\"p-4\"><Skeleton className=\"h-4 w-[40px]\" /></td>\n515:                       <td className=\"p-4\"><Skeleton className=\"h-4 w-[60px]\" /></td>\n516:                       <td className=\"p-4\"><Skeleton className=\"h-4 w-[80px]\" /></td>\n517:                       <td className=\"p-4 text-right\"><Skeleton className=\"h-11 w-11 ml-auto\" /></td>\n518:                     </tr>\n519:                   ))}\n520:                 </tbody>\n521:               </table>\n522:               </div>\n523:             </CardContent>\n524:           </Card>\n525: \n526:           {/* Mobile Cards Skeleton (hidden on desktop) */}\n527:           <div className=\"grid grid-cols-1 gap-3 sm:hidden\">\n528:             {[...Array(3)].map((_, i) => (\n529:               <Card key={i} className=\"w-full\">\n530:                 <CardContent className=\"p-4\">\n531:                   <div className=\"flex items-start justify-between gap-3 mb-3\">\n532:                     <div className=\"flex items-center gap-3 min-w-0 flex-1\">\n533:                       <Skeleton className=\"h-11 w-11 rounded-md\" />\n534:                       <div className=\"min-w-0\">\n535:                         <Skeleton className=\"h-5 w-32 mb-1\" />\n536:                         <Skeleton className=\"h-4 w-24\" />\n537:                       </div>\n538:                     </div>\n539:                     <Skeleton className=\"h-11 w-11 rounded-full\" />\n540:                   </div>\n541:                   <div className=\"grid grid-cols-2 gap-3 text-sm\">\n542:                     <div className=\"space-y-1\">\n543:                       <Skeleton className=\"h-4 w-16\" />\n544:                       <Skeleton className=\"h-6 w-20\" />\n545:                     </div>\n546:                     <div className=\"space-y-1\">\n547:                       <Skeleton className=\"h-4 w-16\" />\n548:                       <Skeleton className=\"h-4 w-16\" />\n549:                     </div>\n550:                     <div className=\"space-y-1\">\n551:                       <Skeleton className=\"h-4 w-16\" />\n552:                       <Skeleton className=\"h-4 w-20\" />\n553:                     </div>\n554:                     <div className=\"space-y-1\">\n555:                       <Skeleton className=\"h-4 w-16\" />\n556:                       <Skeleton className=\"h-4 w-12\" />\n557:                     </div>\n558:                   </div>\n559:                   <div className=\"mt-4 flex sm:hidden\">\n560:                     <Skeleton className=\"h-11 w-full rounded-md\" />\n561:                   </div>\n562:                 </CardContent>\n563:               </Card>\n564:             ))}\n565:           </div>\n566:         </>\n567:       ) : filteredDocuments.length === 0 ? (\n568:         <EmptyState\n569:           icon={FileText}\n570:           title={searchQuery ? \"No documents match your search\" : \"No documents yet\"}\n571:           description={searchQuery ? undefined : \"Upload some files to get started.\"}\n572:         />\n573:       ) : (\n574:         <>\n575:           {/* Desktop Table View (hidden on mobile) */}\n576:           <Card className=\"hidden sm:block\">\n577:             <CardContent className=\"p-0\">\n578:               <div className=\"overflow-x-auto\">\n579:                 <table className=\"w-full\" style={{ tableLayout: 'fixed' }}>\n580:                   <caption className=\"sr-only\">Documents List</caption>\n581:                   <thead>\n582:                     <tr className=\"border-b bg-muted/50\">\n583:                       <th scope=\"col\" className=\"text-left p-4 font-medium\">\n584:                         <Checkbox \n585:                           checked={(selectedIds.size > 0 && selectedIds.size === filteredDocuments.length) ?? false}\n586:                           onCheckedChange={handleSelectAll}\n587:                           aria-label=\"Select all documents\"\n588:                         />\n589:                       </th>\n590:                       <th\n591:                         scope=\"col\"\n592:                         className=\"text-left p-4 font-medium relative\"\n593:                         style={{ width: filenameColWidth }}\n594:                       >\n595:                         Filename\n596:                         <div\n597:                           className=\"absolute right-0 top-0 h-full w-1.5 cursor-col-resize hover:bg-border transition-colors\"\n598:                           onMouseDown={handleResizeMouseDown}\n599:                           role=\"separator\"\n600:                           aria-orientation=\"vertical\"\n601:                           aria-label=\"Resize filename column\"\n602:                         />\n603:                       </th>\n604:                       <th scope=\"col\" className=\"text-left p-4 font-medium\">Status</th>\n605:                       <th scope=\"col\" className=\"text-left p-4 font-medium\">Chunks</th>\n606:                       <th scope=\"col\" className=\"text-left p-4 font-medium\">Size</th>\n607:                       <th scope=\"col\" className=\"text-left p-4 font-medium\">Uploaded</th>\n608:                       <th scope=\"col\" className=\"text-right p-4 font-medium\">Actions</th>\n609:                     </tr>\n610:                   </thead>\n611:                   <tbody>\n612:                     {filteredDocuments.map((doc) => {\n613:                       const docId = String(doc.id);\n614:                       const isSelected = Boolean(selectedIds.has(docId));\n615:                       return (\n616:                         <tr key={doc.id} className={`border-b hover:bg-muted/50 ${isSelected ? 'bg-muted/30' : ''}`}>\n617:                           <td className=\"p-4\">\n618:                             <Checkbox \n619:                               checked={isSelected ?? false}\n620:                               onCheckedChange={(checked) => handleSelectOne(String(doc.id), !!checked)}\n621:                               aria-label={`Select ${doc.filename}`}\n622:                             />\n623:                           </td>\n624:                           <td className=\"p-4\">\n625:                             <div className=\"flex items-center gap-2\">\n626:                               <FileText className=\"w-4 h-4 text-muted-foreground\" />\n627:                               <span className=\"font-medium truncate max-w-full\" title={doc.filename}>{doc.filename}</span>\n628:                             </div>\n629:                           </td>\n630:                           <td className=\"p-4\"><StatusBadge status={doc.metadata?.status as string} /></td>\n631:                           <td className=\"p-4\">{String(doc.metadata?.chunk_count ?? 0)}</td>\n632:                           <td className=\"p-4\">{formatFileSize(doc.size)}</td>\n633:                           <td className=\"p-4 text-muted-foreground\">{formatDate(doc.created_at)}</td>\n634:                           <td className=\"p-4 text-right\">\n635:                             <Button \n636:                               variant=\"ghost\" \n637:                               size=\"icon\" \n638:                               className=\"min-w-[44px] min-h-[44px]\" \n639:                               onClick={() => handleDeleteDocument(String(doc.id))}\n640:                             >\n641:                               <Trash2 className=\"w-4 h-4 text-destructive\" />\n642:                             </Button>\n643:                           </td>\n644:                         </tr>\n645:                       );\n646:                     })}\n647:                   </tbody>\n648:                 </table>\n649:               </div>\n650:             </CardContent>\n651:           </Card>\n652: \n653:            {/* Mobile Cards View (hidden on desktop) */}\n654:            <div className=\"grid grid-cols-1 gap-3 sm:hidden\">\n655:              {filteredDocuments.map((doc) => (\n656:                <DocumentCard\n657:                  key={doc.id}\n658:                  document={doc}\n659:                  onDelete={(id) => handleDeleteDocument(String(id))}\n660:                  isSelected={selectedIds.has(doc.id)}\n661:                  onSelectionChange={handleSelectOne}\n662:                />\n663:              ))}\n664:            </div>\n665:         </>\n666:       )}\n667:     </div>\n668:   );\n669: }\n\n(End of file - total 669 lines)\n</content>","timestamp":1771952941288,"originalBytes":31540}